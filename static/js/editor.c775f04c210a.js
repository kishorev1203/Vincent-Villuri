"use strict";var eljs;(self.webpackChunkeljs=self.webpackChunkeljs||[]).push([[6008],{5251:function(e,t,n){n.d(t,{Tp:function(){return m},dH:function(){return p},oA:function(){return d},qF:function(){return h}});var i=n(9635),s=n.n(i),r=n(181),o=n.n(r),a=n(5897),l=n.n(a),u=n(2020),c=n(5189);function d(e){const t=e.querySelector(".notify-user-mention-button");[e.querySelector("#user-mention-invite-first-name"),e.querySelector("#user-mention-invite-last-name"),e.querySelector("#user-mention-invite-email")].every((function(e){return e.checkValidity()}))?t.classList.remove("disabled"):t.classList.add("disabled")}class m{constructor(e,t,n){this.form=e.closest("form"),this.mentionsInput=this.form.querySelector(".user-mentions-input"),this.inviteForm=document.querySelector("#user-mention-invite-form"),this.memorialSlug=t,this.mentionModalElement=document.querySelector("#modal-user-mention"),this.mentionModal=new(s())(this.mentionModalElement),this.mentionableElement=e,this.processableMentions=new Set,this.searchEndpoint=n,this.currentUserSearch="",this.inviteSuccessModal=document.querySelector(".mention-invite-success-modal"),this.boundSetHiddenUserData=this.setUserQueryValue.bind(null,this),this.boundValidateForm=this.validateInviteForm.bind(this),this.boundAcceptUserData=this.addSubmittedUserDataToProcessableMentions.bind(this)}async showSuccessModal(){this.inviteSuccessModal.classList.remove("d-none"),await(0,c.bE)(this.inviteSuccessModal,"fadeIn"),(0,c.Xn)(this.inviteSuccessModal,5e3)}listenForUserMentionTrigger(){new(l())({allowSpaces:!1,searchOpts:{skip:!0},selectClass:"user-mention-highlight",containerClass:"tribute-container",itemClass:"user-mention-option",selectTemplate:e=>void 0===e?null:("no-match-item"===e.original.userHash?(this.mentionModal.show(),this.setupListenersOnUserMentionInviteForm(e.original.userMentionName)):"rate-limit-item"===e.original.userHash||"match-error-item"===e.original.userHash||this.processableMentions.add(e.original),`@${e.original.userMentionName}`),menuItemTemplate:e=>"no-match-item"===e.original.userHash?`<a data-user-query="${e.original.userMentionName}" class="user-mention-invite-user" target="_blank">No match found - Click to notify person</a>`:e.original.thumbnailUrl?`<span><img class="user-profile-photo" src="${e.original.thumbnailUrl}" alt="User profile photo"></img> ${e.original.userMentionName}</span>`:e.string,noMatchTemplate:null,lookup:"userMentionName",fillAttr:"userHash",values:o()((async(e,t)=>{const n={userMentionName:e,userHash:"no-match-item"},i={userMentionName:"An error occurred. Please wait a few minutes and try again.",userHash:"rate-limited-item"},s={userMentionName:"An error occurred. Please try again.",userHash:"search-error-item"};try{const s=await u.A.get(this.searchEndpoint,{search:e,"memorial-slug":this.memorialSlug});if(!s.ok){if(429===s.status)return t([i]);throw new Error}const r=[...(await s.json()).results];return r.splice(7,0,n),t(r)}catch{return t([s])}}),100,{maxWait:250}),requireLeadingSpace:!0,menuItemLimit:8,menuShowMinLength:3}).attach(this.mentionableElement)}setUserQueryValue(e,t){t.target.classList.contains("modal-open")&&(e.inviteForm.querySelector(".user-mention-query").value=`@${e.currentUserSearch}`)}validateInviteForm(){d(this.inviteForm)}addSubmittedUserDataToProcessableMentions(){const e=this.inviteForm.querySelector(".user-mention-query"),t=this.inviteForm.querySelector("#user-mention-invite-first-name"),n=this.inviteForm.querySelector("#user-mention-invite-last-name"),i=this.inviteForm.querySelector("#user-mention-invite-email"),s=i.value,r=`${t.value} ${n.value}`;this.processableMentions.add({userMentionName:r,email:s,disabled:!0}),"mediumEditorElement"in this.mentionableElement.dataset?window.eljs.editor.replaceContent(this.mentionableElement,e.value,`@${r}`):this.mentionableElement.value=this.mentionableElement.value.replace(e.value,`@${r}`),this.mentionModal.hide(),t.value="",n.value="",i.value="",this.showSuccessModal()}setupListenersOnUserMentionInviteForm(e){this.currentUserSearch=e,document.querySelector("body").addEventListener("click",this.boundSetHiddenUserData),this.inviteForm.addEventListener("input",this.boundValidateForm),this.inviteForm.querySelector(".notify-user-mention-button").addEventListener("click",this.boundAcceptUserData)}addMentionsToFormOnSubmit(){this.mentionsInput&&this.form.addEventListener("submit",(()=>{if(!this.mentionableElement.offsetParent)return;const e=[...this.processableMentions];this.mentionsInput.setAttribute("value",JSON.stringify(e))}))}clearListenersOnUserMentionInviteModalClose(){this.mentionModalElement.addEventListener("hide.bs.modal",(()=>{document.querySelector("body").removeEventListener("click",this.boundSetHiddenUserData),this.inviteForm.removeEventListener("input",this.boundValidateForm),this.inviteForm.querySelector(".notify-user-mention-button").removeEventListener("click",this.boundAcceptUserData)}))}setUp(){this.listenForUserMentionTrigger(),this.addMentionsToFormOnSubmit(),this.clearListenersOnUserMentionInviteModalClose()}}function h(e,t,n){new m(e,t,n).setUp()}function p(e){const{memorialIsExample:t,userMention:{memorialSlug:n,userMentionClass:i,userSearchEndpoint:s}}=e;t||document.querySelectorAll(`.${i}`).forEach((e=>{h(e,n,s)}))}},9181:function(e,t,n){n.r(t),n.d(t,{initEditor:function(){return l},replaceContent:function(){return u}});var i=n(4282),s=n.n(i),r=n(5251),o=n(9927),a=n(5189);function l(e){const{editor:{customButtons:t,disabled:n,inputId:i,inputContainerSelector:l,templates:u,templatesContainerSelector:c},userMention:d}=e;let m,h=!1;if(e.editor.alwaysShowTemplates&&(h=!0),i&&!n){const e=document.getElementById(i),n=e.closest(l);if(m=new(s())([e],{elementsContainer:n,extensions:{imageDragging:{}},imageDragging:!1,placeholder:{text:e.getAttribute("placeholder"),hideOnClick:!1},toolbar:{align:"center",buttons:["bold","italic","underline","orderedlist","unorderedlist"].concat(t||[]),diffTop:80,static:!0,sticky:!0,stickyTopOffset:20,updateOnEmptySelection:!0}}),d){const t=e.parentElement.querySelector('[contenteditable="true"]');(0,r.qF)(t,d.memorialSlug,d.userSearchEndpoint)}if(u&&c){const t=document.querySelector(c);(0,o.A)(t,e,u,(()=>t&&!0!==t.classList.contains("d-none")),!1,m?(e,t)=>{m.getContent().length?window.confirm("Are you sure? Switching to a different template will delete any edits that you've made.")?m.setContent(e,0):t&&t():m.setContent(e,0)}:null,!0,h)}m.subscribe("editableInput",(()=>{(0,a.$I)(e,"input")})),e.addEventListener("el-editor-external-input",(()=>{m.setContent(e.value,0)}))}}function u(e,t,n){const i=s().getEditorFromElement(e);i.setContent(i.getContent().replace(t,n))}},9927:function(e,t,n){n.d(t,{A:function(){return a}});var i=n(9635),s=n.n(i),r=n(5189);const o=[void 0,null,""," ","<p></p>","<p><br></p>"];function a(e,t,n,i=null,a=!1,l=null,u=!0,c=!1){if(e&&t){const d=t.closest("form"),m=d.querySelector(".has-warning-modal"),h=e.querySelector("select"),p=e.querySelector('option[value=""]'),v=document.querySelector(".unedited-template-modal-close"),f=document.querySelector(".unedited-template-modal-save"),g=document.querySelector(".modal-unedited-template");let b=!1;(o.includes(t.value)&&(!i||i())||c)&&e.classList.remove("d-none"),t.addEventListener("input",(()=>{if(1===parseInt(t.dataset.selectedTemplate,10))t.dataset.selectedTemplate=0;else if(o.includes(t.value))b=!1,e.classList.remove("d-none"),p.selected=!0;else{const i=n[h.value]||"";let s;if(u){const e=`<p>${i.replace("\n","</p><p>")}</p>`;s=!(t.value.replace(/\s/g,"")===e.replace(/\s/g,""))}else s=!(t.value.replace(/\s/g,"")===i.replace(/\s/g,""));s&&(c||e.classList.add("d-none"),b=!1)}}));let S=h.value;h.addEventListener("change",(()=>{const e=t.value;if(h.value){const e=n[h.value];t.value=u?`<p>${e.replace("\n","</p><p>")}</p>`:e,t.dataset.selectedTemplate=1,b=!0}else t.value="",t.dataset.selectedTemplate=0,b=!1;const i=S;l&&l(t.value,(()=>{t.value=e,h.value=i,(0,r.$I)(t,"input")})),(0,r.$I)(t,"input"),S=h.value})),f&&f.addEventListener("click",(()=>{s().getOrCreateInstance(g).hide(),f.classList.add("disabled"),(0,r.$I)(d,"cancel-submit-protect"),m.dataset.acknowledgedWarning=!0,m.click()})),g&&v&&v.addEventListener("click",(()=>{s().getOrCreateInstance(g).hide(),(0,r.$I)(d,"cancel-submit-protect")})),d.addEventListener("submit",(e=>{if(m){const t=m.dataset.acknowledgedWarning;!a&&g&&b&&!t&&(e.preventDefault(),e.stopImmediatePropagation(),s().getOrCreateInstance(g).show())}}))}}}},function(e){e.O(0,[6189,6369,6055,9114],(function(){return e(e.s=9181)}));var t=e.O();(eljs=void 0===eljs?{}:eljs).editor=t}]);
//# sourceMappingURL=editor.js.7da0988b3dcc.map