"use strict";(self.webpackChunkeljs=self.webpackChunkeljs||[]).push([[697],{458:function(e,t,o){function n(e){const t=document.querySelector(e);t&&t.addEventListener("click",(()=>{navigator&&navigator.share&&navigator.share({title:t.dataset.shareTitle,url:t.dataset.shareUrl}).catch((()=>{}))}))}o.d(t,{A:function(){return n}}),o(4518)},1432:function(e,t,o){function n(e){let t=1;e.dataset.collapsedLineCount&&(t=parseInt(e.dataset.collapsedLineCount,10));const o=window.getComputedStyle(e).lineHeight,n=parseInt(o.replace("px",""),10),s=n*t,i=Math.max(s/3,2*n);e.scrollHeight>0&&e.scrollHeight<s+20?e.classList.add("show","short"):(e.style.setProperty("--expandable-collapse-gradient-height",`${i}px`),e.style.setProperty("--expandable-collapse-collapsed-height",`${s}px`))}function s(){document.querySelectorAll(".expandable-collapse").forEach((e=>{n(e)}))}o.d(t,{A:function(){return s},i:function(){return n}}),o(8647)},1435:function(e,t,o){o.d(t,{A:function(){return i}});var n=o(5550),s=o.n(n);function i(e){const t=document.getElementById(e.inputId);if(!t)return;const o=new(s())(t,{create:e=>({id:e.trim(),text:e.trim(),created:!0}),maxItems:1,placeholder:"Ex. Cancer",valueField:"id",sortField:[{field:"$order"},{field:"$score"}]});let n;e.initialAutocompleteData&&(o.options[e.initialAutocompleteData.id]||o.addOption(e.initialAutocompleteData),o.setValue(e.initialAutocompleteData.id)),e.notShared&&(n=document.getElementById(e.notShared)),e.notShared&&e.initialPendingData&&o.disable(),e.notShared&&n.addEventListener("change",(()=>{n.checked?(o.clear(),o.disable()):o.enable()}));const i=document.getElementById(e.strInputId);if(i){const e=i.closest("form");e&&e.addEventListener("submit",(()=>{const e=o.options[o.getValue()];e&&e.created?(i.value=e.text,o.clear()):i.value="",n&&n.checked&&(i.value="",o.clear())}))}}},4274:function(e,t,o){o.d(t,{A:function(){return y}});var n=o(9635),s=o.n(n),i=o(5550),r=o.n(i),a=o(3530),l=o.n(a),c=o(1862),d=o.n(c),u=o(5251),m=o(446),h=o(2020);r().define("remove_button",l()),r().define("virtual_scroll",d());const p="no-changes",g=e=>{if(e.name&&e.thumbnailUrl){const t=document.createElement("img");return t.setAttribute("class","user-profile-photo"),t.setAttribute("src",e.thumbnailUrl),t.setAttribute("alt","User profile photo"),(0,m.q)([t,e.name])}return e.name&&!e.thumbnailUrl?(0,m.q)(e.name):null},v=e=>{e.querySelectorAll("input").forEach((e=>{e.value=""})),e.removeAttribute("data-temporary-participant-identifier"),e.querySelector(".temporary-participant-data").setAttribute("value","")};function y(e){const{participantsInitialAutocompleteData:t=[],participantsInputIds:{participants:o,participantsJson:n},userMention:{memorialSlug:i,userSearchEndpoint:a}}=e,l=document.querySelector(`#${o}`);l.classList.add(p);const c=document.querySelector(`#${n}`),d=l.closest("form");l.temporaryParticipants=t;const m=`${o}-temp`,y=document.querySelector("#modal-user-mention"),f=y.querySelector(".temporary-participant-data");function S(){c.setAttribute("value",JSON.stringify(l.temporaryParticipants)),v(y),l.tomselect.clear()}const b=(e,t)=>{const o={search:e,"memorial-slug":i};o.page=t;const n=new URLSearchParams(o);return`${a}?${n.toString()}`},L={sortField:[{field:"$order"},{field:"$score"}],searchField:[],create:e=>{const t=e.trim();return""===t?null:{id:t,name:t,created:!0,text:t}},firstUrl(e){return b(e,1)},async load(e,t){try{const o=await h.A.get(this.getUrl(e));if(!o.ok)throw new h.o(o);const n=await o.json();if(n.pagination.next){const t=b(e,n.pagination.next);this.setNextUrl(e,t)}t(n.results.map((e=>({id:e.userHash,name:e.userMentionName,created:!1,text:e.userMentionName,thumbnailUrl:e.thumbnailUrl,userSlug:e.userSlug}))))}catch(e){e.response&&429===e.response.status||window.Rollbar.error("TomSelect event participant error",e),t()}},loadThrottle:500,render:{option:e=>g(e),not_loading:e=>0===e.input.length?null:'<div class="no-results">Please enter more text.</div>'},shouldLoad:e=>e.length>=3,placeholder:"Example: Laura Adams",plugins:{virtual_scroll:!0,remove_button:{title:"Remove this item"}},valueField:"id"},E=new(r())(l,L);return t&&t.length&&(E.addOptions(t),E.addItems(t.map((e=>e.id)))),E.on("item_remove",(e=>{l.dataset.unselect=!0,l.classList.remove(p);const t=E.options[e];l.temporaryParticipants=l.temporaryParticipants.filter((e=>!(e.id===t.id&&e.name===t.name&&e.created===t.created&&e.userSlug===t.userSlug)))})),E.on("dropdown_open",(()=>{l.dataset.unselect&&(E.close(),l.removeAttribute("data-unselect"))})),E.on("item_add",(e=>{l.classList.remove(p);const t=E.options[e];t.created?(s().getOrCreateInstance(y).show(),f.setAttribute("value",JSON.stringify(t)),y.dataset.temporaryParticipantIdentifier=m):l.temporaryParticipants.push(t)})),d.addEventListener("submit",(()=>{S()})),y.addEventListener("input",(()=>{(0,u.oA)(y.querySelector("form"))})),y.querySelector(".notify-user-mention-button").addEventListener("click",(()=>{if(s().getOrCreateInstance(y).hide(),y.dataset.temporaryParticipantIdentifier===m&&f.value){const e=JSON.parse(f.value),t=y.querySelector("#user-mention-invite-first-name"),o=y.querySelector("#user-mention-invite-last-name"),n=y.querySelector("#user-mention-invite-email");e.name=`${t.value} ${o.value}`,e.email=n.value,l.temporaryParticipants.push(e),v(y)}})),y.querySelector(".cancel-notify-user-mention-button").addEventListener("click",(()=>{y.dataset.temporaryParticipantIdentifier===m&&f.value&&(l.temporaryParticipants.push(JSON.parse(f.value)),v(y))})),S}},5244:function(e,t,o){o.d(t,{A:function(){return d}});var n=o(5550),s=o.n(n),i=o(1862),r=o.n(i),a=o(446),l=o(2020);s().define("virtual_scroll",r());const c=e=>(0,a.q)(e.text);function d(e){const t=document.getElementById(e.cityIdentifierInputId);if(!t)return null;let o=!1;"openUrlOnSelect"in e&&({openUrlOnSelect:o}=e);const n=(t,o)=>{const n={search:t};e.businessTypeName&&(n["for-business-type"]=e.businessTypeName),n.page=o;const s=new URLSearchParams(n);return`${e.citySearchUrl}?${s.toString()}`},i={plugins:["virtual_scroll"],valueField:"id",sortField:[{field:"$order"},{field:"$score"}],searchField:[],firstUrl(e){return n(e,1)},async load(e,t){try{const o=await l.A.get(this.getUrl(e));if(!o.ok)throw new l.o(o);const s=await o.json();if(s.pagination.next){const t=n(e,s.pagination.next);this.setNextUrl(e,t)}t(s.results)}catch(e){e.response&&429===e.response.status||window.Rollbar.error("TomSelect city search error",e),t()}},loadThrottle:500,placeholder:e.placeholder||"Please select a city",render:{option:e=>c(e),not_loading:e=>0===e.input.length?null:'<div class="no-results">Please enter more text.</div>'},shouldLoad:e=>e.length>=3,onChange(e){if(o&&e){const t=this.options[e];o&&(window.location.href=t.url)}},maxItems:1};return new(s())(t,i),t}},5251:function(e,t,o){o.d(t,{Tp:function(){return m},dH:function(){return p},oA:function(){return u},qF:function(){return h}});var n=o(9635),s=o.n(n),i=o(181),r=o.n(i),a=o(5897),l=o.n(a),c=o(2020),d=o(5189);function u(e){const t=e.querySelector(".notify-user-mention-button");[e.querySelector("#user-mention-invite-first-name"),e.querySelector("#user-mention-invite-last-name"),e.querySelector("#user-mention-invite-email")].every((function(e){return e.checkValidity()}))?t.classList.remove("disabled"):t.classList.add("disabled")}class m{constructor(e,t,o){this.form=e.closest("form"),this.mentionsInput=this.form.querySelector(".user-mentions-input"),this.inviteForm=document.querySelector("#user-mention-invite-form"),this.memorialSlug=t,this.mentionModalElement=document.querySelector("#modal-user-mention"),this.mentionModal=new(s())(this.mentionModalElement),this.mentionableElement=e,this.processableMentions=new Set,this.searchEndpoint=o,this.currentUserSearch="",this.inviteSuccessModal=document.querySelector(".mention-invite-success-modal"),this.boundSetHiddenUserData=this.setUserQueryValue.bind(null,this),this.boundValidateForm=this.validateInviteForm.bind(this),this.boundAcceptUserData=this.addSubmittedUserDataToProcessableMentions.bind(this)}async showSuccessModal(){this.inviteSuccessModal.classList.remove("d-none"),await(0,d.bE)(this.inviteSuccessModal,"fadeIn"),(0,d.Xn)(this.inviteSuccessModal,5e3)}listenForUserMentionTrigger(){new(l())({allowSpaces:!1,searchOpts:{skip:!0},selectClass:"user-mention-highlight",containerClass:"tribute-container",itemClass:"user-mention-option",selectTemplate:e=>void 0===e?null:("no-match-item"===e.original.userHash?(this.mentionModal.show(),this.setupListenersOnUserMentionInviteForm(e.original.userMentionName)):"rate-limit-item"===e.original.userHash||"match-error-item"===e.original.userHash||this.processableMentions.add(e.original),`@${e.original.userMentionName}`),menuItemTemplate:e=>"no-match-item"===e.original.userHash?`<a data-user-query="${e.original.userMentionName}" class="user-mention-invite-user" target="_blank">No match found - Click to notify person</a>`:e.original.thumbnailUrl?`<span><img class="user-profile-photo" src="${e.original.thumbnailUrl}" alt="User profile photo"></img> ${e.original.userMentionName}</span>`:e.string,noMatchTemplate:null,lookup:"userMentionName",fillAttr:"userHash",values:r()((async(e,t)=>{const o={userMentionName:e,userHash:"no-match-item"},n={userMentionName:"An error occurred. Please wait a few minutes and try again.",userHash:"rate-limited-item"},s={userMentionName:"An error occurred. Please try again.",userHash:"search-error-item"};try{const s=await c.A.get(this.searchEndpoint,{search:e,"memorial-slug":this.memorialSlug});if(!s.ok){if(429===s.status)return t([n]);throw new Error}const i=[...(await s.json()).results];return i.splice(7,0,o),t(i)}catch{return t([s])}}),100,{maxWait:250}),requireLeadingSpace:!0,menuItemLimit:8,menuShowMinLength:3}).attach(this.mentionableElement)}setUserQueryValue(e,t){t.target.classList.contains("modal-open")&&(e.inviteForm.querySelector(".user-mention-query").value=`@${e.currentUserSearch}`)}validateInviteForm(){u(this.inviteForm)}addSubmittedUserDataToProcessableMentions(){const e=this.inviteForm.querySelector(".user-mention-query"),t=this.inviteForm.querySelector("#user-mention-invite-first-name"),o=this.inviteForm.querySelector("#user-mention-invite-last-name"),n=this.inviteForm.querySelector("#user-mention-invite-email"),s=n.value,i=`${t.value} ${o.value}`;this.processableMentions.add({userMentionName:i,email:s,disabled:!0}),"mediumEditorElement"in this.mentionableElement.dataset?window.eljs.editor.replaceContent(this.mentionableElement,e.value,`@${i}`):this.mentionableElement.value=this.mentionableElement.value.replace(e.value,`@${i}`),this.mentionModal.hide(),t.value="",o.value="",n.value="",this.showSuccessModal()}setupListenersOnUserMentionInviteForm(e){this.currentUserSearch=e,document.querySelector("body").addEventListener("click",this.boundSetHiddenUserData),this.inviteForm.addEventListener("input",this.boundValidateForm),this.inviteForm.querySelector(".notify-user-mention-button").addEventListener("click",this.boundAcceptUserData)}addMentionsToFormOnSubmit(){this.mentionsInput&&this.form.addEventListener("submit",(()=>{if(!this.mentionableElement.offsetParent)return;const e=[...this.processableMentions];this.mentionsInput.setAttribute("value",JSON.stringify(e))}))}clearListenersOnUserMentionInviteModalClose(){this.mentionModalElement.addEventListener("hide.bs.modal",(()=>{document.querySelector("body").removeEventListener("click",this.boundSetHiddenUserData),this.inviteForm.removeEventListener("input",this.boundValidateForm),this.inviteForm.querySelector(".notify-user-mention-button").removeEventListener("click",this.boundAcceptUserData)}))}setUp(){this.listenForUserMentionTrigger(),this.addMentionsToFormOnSubmit(),this.clearListenersOnUserMentionInviteModalClose()}}function h(e,t,o){new m(e,t,o).setUp()}function p(e){const{memorialIsExample:t,userMention:{memorialSlug:o,userMentionClass:n,userSearchEndpoint:s}}=e;t||document.querySelectorAll(`.${n}`).forEach((e=>{h(e,o,s)}))}},5920:function(e,t,o){function n(e,t){if(t){const e=document.getElementById(t.managementForm.fields.TOTALFORMS),o=document.getElementById(t.numberOfAttendeesInput);if(!o)return;const n=o.closest(".add-rsvp-form,.rsvp-form").querySelector(".rsvp-attendees");let{totalFormCount:s}=t;const{emptyForm:i}=t,r=(e=null)=>{let t;t=e||[...n.querySelectorAll(".rsvp-attendee-formset-form:not(.hidden)")].pop(),t&&(t.querySelector('input[type="hidden"]').value="1",t.classList.add("hidden"),0===n.querySelectorAll(".rsvp-attendee-formset-form:not(.hidden)").length&&n.classList.add("d-none"))},a=()=>{const t=document.createElement("div");t.innerHTML=i.replace(/__prefix__/g,s);const a=t.querySelector(".rsvp-attendee-formset-form"),l=a.querySelector(".remove-attendee");l&&l.addEventListener("click",(()=>{o.value=parseInt(o.value,10)-1,r(a)})),n.appendChild(a),s+=1,e.value=s,n.classList.remove("d-none")};n.querySelectorAll(".remove-attendee").forEach((e=>{e.addEventListener("click",(()=>{o.value=parseInt(o.value,10)-1,r(e.closest(".rsvp-attendee-formset-form"))}))})),o.addEventListener("change",(()=>{const e=parseInt(o.value,10)-1,t=n.querySelectorAll(".rsvp-attendee-formset-form:not(.hidden)").length;if(e>t)for(let o=0;o<e-t;o++)a();else if(e<t)for(let o=0;o<t-e;o++)r()}))}}o.d(t,{R:function(){return n}})},7316:function(e,t,o){o.d(t,{b:function(){return i},k:function(){return a}});var n=o(9635),s=o.n(n);const i={FACEBOOK:"facebook",display:e=>e===i.FACEBOOK?"Facebook":"Somewhere"};class r{constructor(e){this.mediaImporter=e,this.auth=null,this.nextCursor=null,this.nextAlbumCursor=null,this.selectedAlbum=null}getAlbumsUrl(){const e="/me/albums?fields=id,images,name,picture";return this.nextAlbumCursor?`${e}&after=${this.nextAlbumCursor}`:e}getMediaUrl(){const e=this.selectedAlbum?`/${this.selectedAlbum.id}/photos?fields=id,images,name,picture`:"/me/photos/uploaded?fields=id,images,name,picture";return this.nextCursor?`${e}&after=${this.nextCursor}`:e}authenticate(e,t=null){const o={return_scopes:!0,scope:"public_profile,user_photos"};t&&(o.auth_type=t),window.FB.login((t=>{"connected"===t.status?t.authResponse.grantedScopes.includes("user_photos")?(this.auth=t.authResponse,this.auth?e():this.mediaImporter.error("There was a problem with your login. Please try again.")):this.mediaImporter.error("You denied permission to your photos. Please try again and be sure to allow photos permissions."):this.mediaImporter.error("An error occurred connecting to your Facebook account. Please try again.")}),o)}loadAlbums(){this.mediaImporter.loading(),this.auth?window.FB.api(this.getAlbumsUrl(),(e=>{e&&!e.error?(this.nextAlbumCursor=25===e.data.length&&e.paging&&e.paging.cursors&&e.paging.cursors.after,this.mediaImporter.albumsReceived(e.data.map((e=>({id:e.id,name:e.name,thumbnail:e.picture.data.url}))))):this.mediaImporter.error(e.error)})):this.authenticate((()=>{this.loadAlbums()}))}selectAlbum(e){this.media=[],this.selectedAlbum=e}loadMedia(){this.mediaImporter.loading(),this.auth?window.FB.api(this.getMediaUrl(),(e=>{e&&!e.error?(this.nextCursor=25===e.data.length&&e.paging&&e.paging.cursors&&e.paging.cursors.after,this.mediaImporter.mediaReceived(e.data.map((e=>({id:e.id,caption:e.name,thumbnail:e.picture,url:e.images[0].source}))))):this.mediaImporter.error(e.error)})):this.authenticate((()=>{this.loadMedia()}))}reset(){this.nextCursor=null,this.nextAlbumCursor=null,this.selectedAlbum=null}}class a{constructor(e,t,o=20){this.root=e,this.modal=s().getOrCreateInstance(this.root),this.albumList=this.root.querySelector(".album-list"),this.mediaGrid=this.root.querySelector(".media-grid"),this.selectedMediaGrid=this.root.querySelector(".selected-media-grid"),this.errorContainer=this.root.querySelector(".overlay.error"),this.loadingContainer=this.root.querySelector(".overlay.loading"),this.loadingMoreContainer=this.mediaGrid.querySelector(".loading-more"),this.loadMoreMedia=this.mediaGrid.querySelector(".load-more"),this.loadingMoreAlbumsContainer=this.albumList.querySelector(".loading-more"),this.loadMoreAlbums=this.albumList.querySelector(".load-more"),this.albums=[],this.selectedAlbum=null,this.media=[],this.selectedMedia=[],this.facebookImporter=new r(this),this.activeImporter=null,this.maximum=o,this.root.querySelector(".max-allowed").innerText=`${this.maximum}`,this.root.addEventListener("hidden.bs.modal",(()=>{this.reset()})),this.mediaGrid.querySelector(".album-back").addEventListener("click",(()=>{this.selectAlbum(null)})),this.root.querySelector(".import-photos-submit").addEventListener("click",(()=>{this.hide(),t(this.selectedMedia.map((e=>e.url)))})),this.loadMoreMedia.addEventListener("click",(()=>{this.activeImporter&&this.activeImporter.loadMedia()})),this.loadMoreAlbums.addEventListener("click",(()=>{this.activeImporter&&this.activeImporter.loadAlbums&&this.activeImporter.loadAlbums()}))}show(e){e===i.FACEBOOK&&(this.activeImporter=this.facebookImporter),this.activeImporter&&(this.activeImporter.loadAlbums?this.activeImporter.loadAlbums():this.activeImporter.loadMedia(),this.root.querySelector(".source-name").innerText=i.display(e),this.modal.show())}hide(){this.modal.hide()}resetMedia(){this.media=[],this.activeImporter&&this.activeImporter.nextCursor&&(this.activeImporter.nextCursor=null)}reset(){this.albums=[],this.selectedAlbum=null,this.selectedMedia=[],this.activeImporter&&this.activeImporter.reset(),this.render()}retry(){this.activeImporter&&(this.activeImporter.auth?this.selectedAlbum||!this.activeImporter.loadAlbums?this.activeImporter.loadMedia():this.activeImporter.loadAlbums():this.activeImporter.authenticate((()=>{this.activeImporter.loadAlbums?this.activeImporter.loadAlbums():this.activeImporter.loadMedia()}),"rerequest"))}mediaReceived(e){this.media.push(...e),this.render()}albumsReceived(e){this.albums.push(...e),this.render()}render(){const e=this.albums.map((e=>`${e.id}`));this.albumList.querySelectorAll(".album").forEach((t=>{e.includes(t.id)||t.remove()})),this.albums.forEach((e=>{if(!document.getElementById(e.id)){const t=document.createElement("a");t.href="javascript:;",t.classList.add("album");const o=document.createElement("img");o.classList.add("thumbnail"),o.src=e.thumbnail;const n=document.createElement("div");n.classList.add("title"),n.innerText=e.name,t.appendChild(o),t.appendChild(n),t.addEventListener("click",(()=>{this.selectAlbum(e)})),this.albumList.insertBefore(t,this.loadingMoreAlbumsContainer)}}));const t=this.media.map((e=>`${e.id}`));this.mediaGrid.querySelectorAll(".media").forEach((e=>{t.includes(e.id)||e.remove()})),this.media.forEach((e=>{const t=document.getElementById(e.id),o=this.selectedMedia.filter((t=>t.id===e.id)).length;if(t)t.classList.toggle("selected",o);else{const t=document.createElement("div");t.classList.add("media"),t.id=e.id,t.classList.toggle("selected",o);const n=document.createElement("img");n.classList.add("media-img"),n.src=e.thumbnail,n.alt=e.caption,t.addEventListener("click",(()=>{this.toggleSelected(e)})),t.appendChild(n),this.mediaGrid.insertBefore(t,this.loadingMoreContainer)}}));const o=this.selectedMedia.map((e=>`${e.id}-selected`));this.selectedMediaGrid.querySelectorAll(".selected-media").forEach((e=>{o.includes(e.id)||e.remove()})),this.selectedMedia.forEach((e=>{const t=`${e.id}-selected`;if(!document.getElementById(t)){const o=document.createElement("img");o.src=e.thumbnail,o.classList.add("selected-media"),o.id=t,o.addEventListener("click",(()=>{this.toggleSelected(e)})),this.selectedMediaGrid.appendChild(o)}}));const n=this.albums.length&&!this.selectedAlbum;this.albumList.classList.toggle("d-none",!n),this.mediaGrid.classList.toggle("d-none",n),this.root.querySelector(".selected-media-container").classList.toggle("d-none",!this.selectedMedia.length),this.root.querySelector(".selected-media-header .count").innerText=`${this.selectedMedia.length} Photo${1===this.selectedMedia.length?"":"s"}`,this.mediaGrid.classList.toggle("maximum-selected",this.selectedMedia.length>=this.maximum),this.loadMoreMedia.classList.toggle("d-none",!this.activeImporter.nextCursor),this.loadMoreAlbums.classList.toggle("d-none",!this.activeImporter.nextAlbumCursor),this.loading(!1)}selectAlbum(e){this.selectedAlbum=e,this.resetMedia(),this.selectedAlbum&&this.selectedAlbum.children?(this.mediaGrid.querySelector(".album-title").classList.toggle("d-none",!e),this.mediaGrid.querySelector(".title-value").innerText=`${this.selectedAlbum.children.length} photos`,this.media=e.children):(this.mediaGrid.querySelector(".album-title").classList.toggle("d-none",!e),this.mediaGrid.querySelector(".title-value").innerText=e?e.name:"",this.activeImporter.selectAlbum?this.activeImporter.selectAlbum(this.selectedAlbum):this.albums.length||this.activeImporter.loadMedia(),this.selectedAlbum&&this.activeImporter.loadMedia()),this.render()}toggleSelected(e){this.selectedMedia.includes(e)?this.selectedMedia=this.selectedMedia.filter((t=>t.id!==e.id)):this.selectedMedia.length<this.maximum&&this.selectedMedia.push(e),this.render()}loading(e=!0){e?this.media&&this.media.length||this.selectedAlbum?this.loadingMoreContainer.classList.remove("d-none"):this.albums&&this.albums.length&&!this.selectedAlbum?this.loadingMoreAlbumsContainer.classList.remove("d-none"):this.loadingContainer.classList.remove("d-none"):(this.loadingMoreContainer.classList.add("d-none"),this.loadingMoreAlbumsContainer.classList.add("d-none"),this.loadingContainer.classList.add("d-none"))}error(e,t=!0){this.loading(!1),e&&(this.errorContainer.querySelector(".message").innerText=e,this.errorContainer.querySelector(".retry").classList.toggle("d-none",!t)),this.errorContainer.classList.toggle("d-none",!e)}}},7914:function(e,t,o){o.d(t,{A:function(){return n}});class n{constructor(e,t=0){this.root=e,this.circle=this.root.querySelector(".progress-ring__circle"),this.label=this.root.querySelector(".progress-ring__label");const o=2*this.circle.r.baseVal.value*Math.PI;this.circle.style.strokeDasharray=`${o} ${o}`,this.circle.style.strokeDashoffset=`${o}`,this.setPercentage(parseInt(t,10))}setPercentage(e){const t=2*this.circle.r.baseVal.value*Math.PI;this.circle.style.strokeDashoffset=t-e/100*t,this.label&&(this.label.textContent=`${e}%`)}}},8250:function(e,t,o){o.d(t,{A:function(){return d}});var n=o(2037),s=o(8647),i=o.n(s),r=o(5189);const a=(e,t)=>{e&&(e.toggleAttribute("disabled",!t),e.classList.toggle("disabled",!t))},l=()=>{const e=document.querySelector("#pc-form .payment-error");e&&e.classList.add("d-none")},c=e=>{const t=document.querySelector("#pc-form .payment-error");t&&(t.innerText=e,(0,r.qG)(t))};async function d(e){const t=await(0,n.c)(e.stripePublishableKey);document.body.addEventListener("payableCheckoutStarted",(()=>{l()})),document.body.addEventListener("payableCheckoutCanceled",(e=>{e&&e.payload&&e.payload.message&&(c(e.payload.message),a(document.querySelector("#payable-checkout-submit"),!1))})),document.body.addEventListener("initPayableCheckout",(e=>{(0,r.$I)(document.body,"elep:disable"),(0,r.PA)(document.body);const o=document.getElementById("pc-form");if(o){const n=t.elements({clientSecret:e.detail.clientSecret,fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Lato:300,400,700"}],loader:"always"}),s={base:{fontFamily:"Lato",fontSize:"18px","::placeholder":{color:"#8e8e8e"}},invalid:{color:"#c30c30"}},d=document.querySelector("#payable-checkout-submit"),u=document.getElementById("zip"),m=document.getElementById("cardholder-name"),h=i().getOrCreateInstance(".stripe-element-container",{toggle:!1}),p=n.create("cardNumber",{showIcon:!0,style:s}),g=n.create("cardExpiry",{style:s}),v=n.create("cardCvc",{style:s});p.on("ready",(()=>{d.classList.remove("d-none"),a(d,!1)})),p.mount("#pc-card-element"),g.mount("#pc-exp-element"),v.mount("#pc-cvc-element");let y=!1,f=!1,S=!1;const b=()=>y&&f&&S&&u.value.length>=3&&m.value;[p,g,v].forEach((e=>e.on("change",(t=>{switch(e){case p:y=t.complete;break;case g:f=t.complete;break;case v:S=t.complete}const o=b()&&t.complete&&!t.error;a(d,o),t.error&&t.error.message?c(t.error.message,d):t.error||l(d)})))),u.addEventListener("input",(()=>{a(d,b())})),m.addEventListener("input",(()=>{a(d,b())}));const L=o.querySelector('select[name="saved-payment-method"]');L&&L.addEventListener("change",(()=>{L.value?(h.hide(),a(d,!0)):(h.show(),a(d,!1))}));const E=o.querySelector("#save-payment-method"),q=async(n=null,s=null)=>{let i;if(e.detail.isSetupIntent)i=await t.confirmCardSetup(e.detail.clientSecret,{payment_method:{card:p,billing_details:{name:m.value,address:{postal_code:u.value}}}});else{let o;n?o={payment_method:n.id}:(o={payment_method:{card:p,billing_details:{name:m.value,address:{postal_code:u.value}}}},E&&E.checked&&(o.setup_future_usage="off_session")),i=await t.confirmCardPayment(e.detail.clientSecret,o)}if(i.error)return s&&s("fail"),i.error.message?(c(i.error.message),a(d,!1)):window.Rollbar&&window.Rollbar.error("Error confirming checkout "+(e.detail.isSetupIntent?"setup":"payment"),i.error),(0,r.$I)(o,"payableCheckoutCanceled",i.error),void(0,r.$I)(o,"cancel-submit-protect");if(s&&s("success"),!e.detail.isSetupIntent&&"requires_action"===i.paymentIntent.status){const n=await t.confirmCardPayment(e.detail.clientSecret);if(n.error)return n.error.message?(c(n.error.message),a(d,!1)):window.Rollbar&&window.Rollbar.error(`Error confirming checkout ${e.detail.isSetupIntent?"setup":"payment"} (inner confirm)`,i.error),(0,r.$I)(o,"payableCheckoutCanceled",n.error),void(0,r.$I)(o,"cancel-submit-protect")}(0,r.$I)(o,"payableCheckoutComplete")},w=t.paymentRequest(e.detail.paymentRequestParams),I=n.create("paymentRequestButton",{paymentRequest:w});(async()=>{await w.canMakePayment()&&(document.getElementById("pc-payment-request-container").classList.add("show"),I.mount("#pc-payment-request-button"))})(),w.on("paymentmethod",(async e=>{await q(e.paymentMethod,e.complete)})),o.addEventListener("submit",(async e=>{e.preventDefault(),(0,r.$I)(o,"payableCheckoutStarted"),L&&L.value?(0,r.$I)(o,"savedPaymentMethodSubmit"):await q()}))}}))}},8277:function(e,t,o){o.d(t,{f:function(){return r},r:function(){return i}});var n=o(5189);const s=()=>CSS&&(CSS.supports("backdrop-filter: blur(20px)")||CSS.supports("-webkit-backdrop-filter: blur(20px)"));function i(e=.2){const t=document.querySelectorAll(".product-photo");t&&t.forEach&&t.forEach((t=>{t.addEventListener("load",(()=>{(t=>{const o=t.naturalWidth/t.naturalHeight;if(Math.abs(o-1.333)<=e)t.closest(".product-photo-container").classList.add("fill");else{const e=document.createElement("canvas");e.width=t.naturalWidth,e.height=t.naturalHeight;const o=e.getContext("2d");o.drawImage(t,0,0,t.naturalWidth,t.naturalHeight);const n=[[0,0],[0,e.height/2],[0,e.height-1],[e.width/2,0],[e.width/2,e.height-1],[e.width-1,0],[e.width-1,e.height/2],[e.width-1,e.height-1]].map((e=>o.getImageData(e[0],e[1],1,1).data.slice(0,4))),i=t.parentNode;if(n.every((e=>e.every(((e,t)=>e===n[0][t]))))){const e=n[0];i.style.backgroundColor=`rgb(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}else if("objectFit"in document.documentElement.style&&s())i.style.backgroundImage=`url('${t.src}')`,i.style.backgroundSize="cover";else{const e=n.reduce(((e,t)=>e.map(((e,o)=>e+t[o]))),[0,0,0,0]).map((e=>e/n.length));i.style.backgroundColor=`rgb(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}}})(t)})),t.complete&&(0,n.$I)(t,"load")}))}function r(e){if(document.querySelectorAll('[data-toggle-for="delivery-instructions"]').forEach((e=>e.addEventListener("click",(()=>{document.querySelectorAll('[data-toggle-name="delivery-instructions"]').forEach((e=>{e.classList.toggle("d-none")}))})))),!e.skipBillingAndDeliverySync){let t=!1;const o=document.getElementById(e.formFieldIds.deliveryName),s=document.getElementById(e.formFieldIds.billingName);o&&s&&(o.addEventListener("input",(()=>{t&&s.value||(s.value=o.value,t=!1,(0,n.$I)(s,"fill"))})),s.addEventListener("click",(()=>{t=!0})))}}},9573:function(e,t,o){o.r(t),o.d(t,{initAIObituaryComposerForm:function(){return pt},initFeedbackForm:function(){return ct},initFundraiserOnboarding:function(){return Ee},initInvites:function(){return Le},initLegacyEdit:function(){return lt},initMemorialDeceasedForm:function(){return Ke},initMemorialInvitePeople:function(){return Ge},initMemorialNote:function(){return st},initMemorialObituary:function(){return nt},initMemorialOnboardingEvents:function(){return we},initMemorialOnboardingFamily:function(){return Ie},initMemorialOnboardingFinalRestingPlace:function(){return Ae},initMemorialOnboardingFundraisingGuidance:function(){return ke},initMemorialOnboardingInviteManager:function(){return qe},initMemorialOnboardingPhoto:function(){return xe},initMemorialOnboardingShare:function(){return Fe},initMemorialPrivateBase:function(){return Ve},initMemorialPrivateBasicInformation:function(){return Je},initMemorialPrivateBelongings:function(){return ut},initMemorialPrivateChooseCause:function(){return Me},initMemorialPrivateCommunityContent:function(){return ht},initMemorialPrivateDashboard:function(){return We},initMemorialPrivateEvents:function(){return ot},initMemorialPrivateFamily:function(){return tt},initMemorialPrivateFavorites:function(){return Xe},initMemorialPrivateGifts:function(){return Qe},initMemorialPrivateHowToHelp:function(){return be},initMemorialPrivateNoteAndUpdates:function(){return dt},initMemorialPrivatePassing:function(){return Ye},initMemorialPrivatePremium:function(){return rt},initMemorialPrivateSettings:function(){return at},initPartnerObituaryOrderCheckout:function(){return Be},initPhotoArchiveRequest:function(){return mt}});var n=o(8109),s=o(6484),i=o.n(s),r=o(114),a=o.n(r),l=o(8647),c=o.n(l),d=(o(2453),o(9635)),u=o.n(d),m=(o(8013),o(2020)),h=o(5189);class p{constructor(e,t){this.modalContainer=e,this.createUrl=t.createUrl,this.editUrl=t.editUrl,this.modal=new(u())(this.modalContainer),this.titleNameSpan=this.modalContainer.querySelector(".belonging-editor--name"),this.titleClaimedBadge=this.modalContainer.querySelector(".belonging-editor--claimed"),this.titleAvailableBadge=this.modalContainer.querySelector(".belonging-editor--available"),this.productPhoto=this.modalContainer.querySelector(".product-photo"),this.productPhotoPlaceholder=this.productPhoto.src;const o=t.belongingFormFieldIds;this.photoInput=document.getElementById(o.photo),this.nameInput=document.getElementById(o.name),this.descriptionTextarea=document.getElementById(o.description),this.isPublishedCheckbox=document.getElementById(o.isPublished),this.isClaimedCheckbox=document.getElementById(o.isClaimed),this.productPhoto.addEventListener("click",(()=>{this.photoInput.click()})),this.nameInput.addEventListener("input",(()=>{this.renderDependents()})),this.isClaimedCheckbox.addEventListener("change",(()=>{this.renderDependents()})),this.photoInput.addEventListener("change",(()=>{const e=(0,h.TT)(this.photoInput);if(e){const t=new FileReader;t.onload=e=>{this.productPhoto.src=e.target.result,this.productPhoto.parentNode.style.backgroundImage=`url('${e.target.result}');`},t.readAsDataURL(e)}})),this.activeBelonging=null,this.onBelongingChanged=t.onBelongingChanged,this.form=this.modalContainer.querySelector("form"),this.form.addEventListener("submit",(e=>{e.preventDefault(),e.stopPropagation()})),this.saveButton=this.modalContainer.querySelector(".save-belonging-details"),this.saveButton.addEventListener("click",(()=>{this.save()}))}renderDependents(){this.titleClaimedBadge.classList.toggle("d-none",!this.isClaimedCheckbox.checked),this.titleAvailableBadge.classList.toggle("d-none",this.isClaimedCheckbox.checked),this.titleNameSpan.innerText=this.nameInput.value,this.productPhoto.setAttribute("alt",this.nameInput.value)}reset(){this.photoInput.value=null,this.nameInput.value="",this.descriptionTextarea.value="",this.isPublishedCheckbox.checked=!1,this.isClaimedCheckbox.checked=!1,this.titleNameSpan.innerText="",this.productPhoto.setAttribute("alt",""),this.modalContainer.querySelector(".alert-danger").classList.add("d-none"),this.renderDependents()}dismiss(){this.reset(),this.modal.hide()}showForBelonging(e){this.activeBelonging=e;let t=!1;this.activeBelonging?(this.nameInput.value=this.activeBelonging.name,this.descriptionTextarea.value=this.activeBelonging.description,this.isPublishedCheckbox.checked=this.activeBelonging.isPublished,this.isClaimedCheckbox.checked=this.activeBelonging.isClaimed,this.productPhoto.src=this.activeBelonging.photo,this.productPhoto.parentNode.style.backgroundImage=`url('${this.activeBelonging.photo}');`):(this.nameInput.value="",this.descriptionTextarea.value="",this.isPublishedCheckbox.checked=!0,this.isClaimedCheckbox.checked=!1,this.productPhoto.src=this.productPhotoPlaceholder,this.productPhoto.parentNode.style.backgroundImage="none",t=!0),(0,h.$I)(this.nameInput,"input"),this.renderDependents(),this.modal.show(),t&&this.photoInput.click()}getUrl(){return this.activeBelonging&&this.activeBelonging.id?this.editUrl.replace("__id__",this.activeBelonging.id):this.createUrl}async save(){this.saveButton.dataset.clicked=!0;const e=(0,h.SE)(this.saveButton);this.modalContainer.querySelector(".alert-danger").classList.add("d-none"),this.modalContainer.querySelectorAll(".errorlist").forEach((e=>{for(;e.hasChildNodes();)e.removeChild(e.lastChild);e.classList.add("d-none")}));const t=()=>{const e=this.modalContainer.querySelector(".alert-danger");e.classList.remove("d-none"),e.querySelector(".error-message").innerText="An unknown error occurred."};let o;try{const e=await m.A.post(this.getUrl(),this.form);if(!e.ok)return void t();o=await e.json()}catch(e){throw t(),e}o.success?(e(),this.onBelongingChanged(o.data,this),this.dismiss()):(o=>{if(window.Rollbar.error("Error modifying Belonging",o.responseJSON?o.responseJSON.errors:o),e(),o.errors){const e=this.modalContainer.querySelector(".alert-danger");e.classList.remove("d-none"),e.querySelector(".error-message").innerText=o.errors.main||"An unknown error occurred.",Object.keys(o.errors).forEach((e=>{if("main"===e)return;const t=this.modalContainer.querySelector(`.${e}-errorlist`);t&&(t.classList.remove("d-none"),o.errors[e].forEach((e=>{const o=document.createElement("li");o.innerText=e,t.appendChild(o)})))}))}else t()})(o)}}var g=o(8277),v=o(181),y=o.n(v);class f{constructor(e){if(this.textField=e,this.storageKey=this.textField.dataset.autosaveKey,this.remoteLastUpdated=parseFloat(this.textField.dataset.autosaveLastUpdated)||0,this.storageAvailable=(0,h.VS)("localStorage"),this.textField.addEventListener("input",y()((()=>{this.store()}),100,{maxWait:250})),this.initialValue=this.textField.value,this.load(),this.textField.value&&setTimeout((()=>{(0,h.$I)(this.textField,"input")}),300),this.indicator=document.querySelector(`[data-autosave-indicator-for="${this.textField.id}"]`),this.indicator){const e=this.indicator.querySelector(".revert-autosave");e&&e.addEventListener("click",(()=>{this.clear()}))}}load(e=!1){if(this.storageAvailable){const t=JSON.parse(window.localStorage.getItem(this.storageKey));t&&t.timestamp&&t.text&&(parseFloat(t.timestamp)>this.remoteLastUpdated||e)&&(this.textField.value=t.text,(0,h.$I)(this.textField,"input"),(0,h.$I)(this.textField,"el-editor-external-input"))}}store(){if(this.storageAvailable)if(this.textField.value){const e={text:this.textField.value,timestamp:Date.now()/1e3};window.localStorage.setItem(this.storageKey,JSON.stringify(e))}else window.localStorage.removeItem(this.storageKey);this.updateIndicator()}clear(){this.storageAvailable&&window.localStorage.removeItem(this.storageKey),this.textField.value=this.initialValue,(0,h.$I)(this.textField,"input"),(0,h.$I)(this.textField,"el-editor-external-input"),this.updateIndicator()}updateIndicator(){if(this.indicator){const e=this.textField.value===this.initialValue||""===this.initialValue&&("<p></p>"===this.textField.value||"<p><br></p>"===this.textField.value);this.indicator.classList.toggle("d-none",e)}}}var S=o(9241);function b(e,t,o,n=!1){if(e&&e.businessIdentifierInputId){let s={},i=!1;t&&(s=e.initialAutocompleteData,i=e.initialPendingData);const r={...e,businessPlaceholder:o,initialPendingData:i,initialAutocompleteData:s,addSubmitListener:n},a=document.getElementById(e.businessIdentifierInputId);a&&a.tomselect&&a.tomselect.destroy(),(0,S.A)(r)}}function L(e){e.forEach((e=>{e.querySelectorAll('input[type="radio"]').forEach((e=>{e.checked=!1}));const t=e.querySelector("textarea");t&&(t.value=""),e.parentNode.parentNode.querySelectorAll(":scope .errorlist").forEach((e=>e.classList.add("d-none")))}))}function E(e,t,o){e.classList.toggle("d-none",!t&&!o)}function q(e){const{isOnboarding:t}=e,o=document.querySelectorAll(".edit-disposition-method"),n=document.querySelectorAll(".business-association-input-group"),s=document.querySelector(".funeral-home-input-group"),i=document.querySelector(".cemetery-input-group"),r=document.querySelector(".donation-org-input-group"),a=document.querySelector(".sea-burial-provider-input-group"),l=document.querySelector(".location-type-input-group"),d=document.querySelector(".location-input-group"),u=document.querySelector("#id_business_association-remains_location_type"),p=document.querySelector("#id_business_association-remains_location"),g=s.querySelector(".dark-gray-label"),v=s.querySelector("label"),y=l.querySelector(`option[value="${e.remainsLocationTypeNoRemains}"]`),f=(e=!0,t=!1,o=!1)=>{t?(g.innerText="Funeral home or cremation provider",v.innerText="I have not yet chosen a funeral home or cremation provider"):e?(g.innerText="Funeral home",v.innerText="I have not yet chosen a funeral home"):o?(g.innerText="Provider",v.innerText="I have not yet chosen a provider"):(g.innerText="Cremation provider",v.innerText="I have not yet chosen a cremation provider")},S=()=>{const n=document.querySelectorAll('[name="business_association-disposition_method"]:not(:checked)'),r=document.querySelector('[name="business_association-disposition_method"]:checked');if(r){const e=r.closest(".el-radio-btn");n.forEach((e=>{e.closest(".el-radio-btn").classList.add("d-none")})),e.classList.remove("d-none"),e.querySelector(".edit-disposition-method").classList.remove("d-none")}else n.forEach((e=>{e.closest(".el-radio-btn").classList.remove("d-none")})),o.forEach((e=>{e.classList.add("d-none")})),b(e.funeralHomeSearch,!0,e.funeralHomeSearch.businessPlaceholder),(document.getElementById(e.funeralHomeSearch.businessIdentifierInputId).value||document.getElementById(e.funeralHomeSearch.businessStrInputId).value||document.getElementById(e.funeralHomeSearch.businessPending).checked)&&E(s,t,!0),b(e.cemeterySearch,!0,e.cemeterySearch.businessPlaceholder),(document.getElementById(e.cemeterySearch.businessIdentifierInputId).value||document.getElementById(e.cemeterySearch.businessStrInputId).value||document.getElementById(e.cemeterySearch.businessPending).checked)&&i.classList.remove("d-none")},q=()=>{E(s,t,!0),i.classList.remove("d-none"),f()},w=(e=!1)=>{E(s,t,!0),l.classList.remove("d-none"),f(!1,!1,e),y.classList.add("d-none")},I=()=>{r.classList.remove("d-none"),l.classList.remove("d-none"),y.classList.remove("d-none")},A=()=>{E(s,t,!0),a.classList.remove("d-none"),d.classList.remove("d-none"),f(),d.querySelector(".dark-gray-label").innerText="Ocean (Location)",document.getElementById("id_business_association-remains_location").setAttribute("placeholder","Ex: Pacific ocean")},k=()=>{E(s,t,!0),d.classList.remove("d-none")};E(s,t,!0),f(null,!0),o.forEach((e=>{e.addEventListener("click",(()=>{document.querySelectorAll('[name="business_association-disposition_method"]:not(:checked)').forEach((e=>{e.closest(".el-radio-btn").classList.remove("d-none")})),o.forEach((e=>{e.classList.add("d-none")}))}))})),document.querySelectorAll('[name="business_association-disposition_method"]').forEach((t=>{t.addEventListener("change",(()=>{t.checked&&function(e){b(e.cemeterySearch,!1,e.cemeterySearch.businessPlaceholder),b(e.donationOrgSearch,!1,e.donationOrgSearch.businessPlaceholder),b(e.seaBurialProviderSearch,!1,e.seaBurialProviderSearch.businessPlaceholder),[document.getElementById(e.cemeterySearch.businessIdentifierInputId),document.getElementById(e.donationOrgSearch.businessIdentifierInputId),document.getElementById(e.seaBurialProviderSearch.businessIdentifierInputId)].forEach((e=>{e&&e.tomselect&&(e.tomselect.clear(),e.tomselect.clearOptions(),e.tomselect.enable())})),[document.getElementById("id_business_association-remains_location_type"),document.getElementById("id_business_association-remains_location")].forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("disabled")})),[document.getElementById(e.funeralHomeSearch.businessStrInputId),document.getElementById(e.cemeterySearch.businessStrInputId),document.getElementById(e.donationOrgSearch.businessStrInputId),document.getElementById(e.seaBurialProviderSearch.businessStrInputId),document.getElementById("id_business_association-remains_location")].forEach((e=>{e&&e.tomselect?e.tomselect.clear():e.value=""})),document.getElementById("id_business_association-remains_location").value="",[document.getElementById(e.funeralHomeSearch.businessPending),document.getElementById(e.cemeterySearch.businessPending),document.getElementById(e.donationOrgSearch.businessPending),document.getElementById(e.seaBurialProviderSearch.businessPending),document.getElementById("id_business_association-remains_location_type_pending"),document.getElementById("id_business_association-remains_location_pending")].forEach((e=>{e.checked=!1})),document.getElementById("id_business_association-remains_location_metadata").value="{}",document.querySelector(".location-input-group .dark-gray-label").innerText="Location",document.getElementById("id_business_association-remains_location").setAttribute("placeholder","Ex: 123 Green street, San Francisco, CA"),document.getElementById("id_business_association-remains_location_type").value="",document.querySelector(".business-association-review-section").classList.add("d-none"),L(document.querySelectorAll(".review-input-wrapper"))}(e)}))}));const x=document.getElementById("id_business_association-disposition_method_0");x.addEventListener("change",(()=>{x.checked&&(n.forEach((e=>{[s,i].includes(e)||e.classList.add("d-none")})),q(),b(e.funeralHomeSearch,!1,e.funeralHomeSearch.businessPlaceholder),S())}));const C=document.getElementById("id_business_association-disposition_method_1");C.addEventListener("change",(()=>{C.checked&&(n.forEach((e=>{[s,l].includes(e)||e.classList.add("d-none")})),w(),S())}));const _=document.getElementById("id_business_association-disposition_method_2");_.addEventListener("change",(()=>{_.checked&&(n.forEach((e=>{[r,l].includes(e)||e.classList.add("d-none")})),I(),S())}));const P=document.getElementById("id_business_association-disposition_method_3");P.addEventListener("change",(()=>{P.checked&&(n.forEach((e=>{[s,a,l].includes(e)||e.classList.add("d-none")})),A(),b(e.funeralHomeSearch,!1,e.funeralHomeSearch.businessPlaceholder),S())}));const F=document.getElementById("id_business_association-disposition_method_4");F.addEventListener("change",(()=>{F.checked&&(n.forEach((e=>{[s,l].includes(e)||e.classList.add("d-none")})),w(!0),S())}));const $=document.getElementById("id_business_association-disposition_method_5");$.addEventListener("change",(()=>{$.checked&&(n.forEach((e=>{[s,l].includes(e)||e.classList.add("d-none")})),w(),S())}));const B=document.getElementById("id_business_association-disposition_method_6");B.addEventListener("change",(()=>{B.checked&&(t?n.forEach((e=>{[s,l].includes(e)||e.classList.add("d-none")})):n.forEach((e=>{e!==d&&e.classList.add("d-none")})),k(),S(),f())}));const M=document.getElementById("id_business_association-disposition_method_7");M.addEventListener("change",(()=>{M.checked&&(n.forEach((e=>{e!==s&&e.classList.add("d-none")})),S())}));const T=()=>{p.removeAttribute("disabled"),p.classList.remove("disabled"),p.value="",document.getElementById("id_business_association-remains_location_metadata").value="{}",document.querySelector(".location-input-group .dark-gray-label").innerText="Location",p.setAttribute("placeholder","Ex: 123 Green street, San Francisco, CA"),document.getElementById("id_business_association-remains_location_pending").checked=!1},O=()=>{const t=document.getElementById(e.cemeterySearch.businessIdentifierInputId);t.tomselect&&(t.tomselect.clear(),t.tomselect.clearOptions(),t.tomselect.enable()),document.getElementById(e.cemeterySearch.businessPending).checked=!1},U=t=>{u.value===e.remainsLocationTypeCemetery.toString()?(i.classList.remove("d-none"),d.classList.add("d-none"),b(e.cemeterySearch,!!t,e.cemeterySearch.businessPlaceholder)):u.value!==e.remainsLocationTypeNoRemains.toString()&&u.value?u.value&&(d.classList.remove("d-none"),i.classList.add("d-none")):(d.classList.add("d-none"),i.classList.add("d-none"))};u.addEventListener("change",(()=>{T(),O(),U(!1)}));const D=document.getElementById("id_business_association-remains_location_type_pending"),N=document.getElementById("id_business_association-remains_location_pending"),R=()=>{const e=document.getElementById("id_business_association-remains_location_type");D.checked?(e.setAttribute("disabled","disabled"),e.classList.add("disabled"),u.value=""):(e.removeAttribute("disabled"),e.classList.remove("disabled"),U(!0))},H=()=>{N.checked?(p.setAttribute("disabled","disabled"),p.classList.add("disabled"),p.value=""):(p.removeAttribute("disabled"),p.classList.remove("disabled"))};D.addEventListener("click",(()=>{R(),T(),O(),U(!1)})),N.addEventListener("click",(()=>{H()})),S(),b(e.funeralHomeSearch,!0,e.funeralHomeSearch.businessPlaceholder,!0),b(e.cemeterySearch,!0,e.cemeterySearch.businessPlaceholder,!0),b(e.hospiceSearch,!0,e.hospiceSearch.businessPlaceholder,!0),b(e.donationOrgSearch,!0,e.donationOrgSearch.businessPlaceholder,!0),b(e.deathDoulaSearch,!0,e.deathDoulaSearch.businessPlaceholder,!0),b(e.seaBurialProviderSearch,!0,e.seaBurialProviderSearch.businessPlaceholder,!0),H();const z=document.querySelector('[name="business_association-disposition_method"]:checked');z===x?q():z===C?(w(),R()):z===_?(I(),R()):z===P?A():z===F||z===$?(w(),R()):z===B&&k(),e.disableReviews||function(e){const t=document.querySelector(".business-association-review-section"),o=document.querySelector(".review-form-header"),n=document.querySelector(".funeral-home-review-section"),s=document.querySelector(`#${e.funeralHomeSearch.businessIdentifierInputId}`),i=document.querySelector(`#${e.funeralHomeSearch.businessPending}`),r=n.querySelector("button"),a=document.querySelector(".cemetery-review-section"),l=document.querySelector(`#${e.cemeterySearch.businessIdentifierInputId}`),d=document.querySelector(`#${e.cemeterySearch.businessPending}`),u=a.querySelector("button"),p=document.querySelector(".hospice-review-section"),g=document.querySelector(`#${e.hospiceSearch.businessIdentifierInputId}`),v=document.querySelector(`#${e.hospiceSearch.businessPending}`),y=p.querySelector("button"),f=document.querySelector(".donation-org-review-section"),S=document.querySelector(`#${e.donationOrgSearch.businessIdentifierInputId}`),b=document.querySelector(`#${e.donationOrgSearch.businessPending}`),E=f.querySelector("button"),q=document.querySelector(".death-doula-review-section"),w=document.querySelector(`#${e.deathDoulaSearch.businessIdentifierInputId}`),I=document.querySelector(`#${e.deathDoulaSearch.businessPending}`),A=q.querySelector("button"),k=()=>{const r=s.tomselect.options[s.tomselect.getValue()],c=l.tomselect.options[l.tomselect.getValue()],u=g.tomselect.options[g.tomselect.getValue()],m=S.tomselect.options[S.tomselect.getValue()],h=w.tomselect.options[w.tomselect.getValue()],y=e.businessesUserHasReviewed.funeralHomes,L=e.businessesUserHasReviewed.cemeteries,E=e.businessesUserHasReviewed.hospices,A=e.businessesUserHasReviewed.donationOrgs,k=e.businessesUserHasReviewed.deathDoulas;let x=!1,C=!1,_=!1,P=!1,F=!1;if(r&&r.id&&!r.created&&!i.checked){const e=r.id,t=r.text;if(x=!y.includes(e),x){n.classList.remove("d-none");const e=n.querySelector("span");e&&(e.innerText=t)}else n.classList.add("d-none")}else n.classList.add("d-none");if(c&&c.id&&!c.created&&!d.checked){const e=c.id,t=c.text;if(C=!L.includes(e),C){a.classList.remove("d-none");const e=a.querySelector("span");e&&(e.innerText=t)}else a.classList.add("d-none")}else a.classList.add("d-none");if(u&&u.id&&!u.created&&!v.checked){const e=u.id,t=u.text;if(_=!E.includes(e),_){p.classList.remove("d-none");const e=p.querySelector("span");e&&(e.innerText=t)}else p.classList.add("d-none")}else p.classList.add("d-none");if(m&&m.id&&!m.created&&!b.checked){const e=m.id,t=m.text;if(P=!A.includes(e),P){f.classList.remove("d-none");const e=f.querySelector("span");e&&(e.innerText=t)}else f.classList.add("d-none")}else f.classList.add("d-none");if(h&&h.id&&!h.created&&!I.checked){const e=h.id,t=h.text;if(F=!k.includes(e),F){q.classList.remove("d-none");const e=q.querySelector("span");e&&(e.innerText=t)}else q.classList.add("d-none")}else q.classList.add("d-none");x||C||_||P||F?(t.classList.remove("d-none"),o.classList.remove("d-none")):t.classList.add("d-none")},x=async(t,i)=>{const r=(0,h.SE)(t),c=t.dataset.submitUrl,d=t.closest(".review-form-container").querySelector(".review-input-wrapper"),u=d.querySelector("textarea").value,v=d.querySelector('input[type="radio"]:checked').value,y=new URLSearchParams(window.location.search).get("association-flow");let b="",E="";i===e.funeralHomeSearch.businessTypeName?(b=s.tomselect.getValue(),E=s.tomselect.options[s.tomselect.getValue()].text):i===e.cemeterySearch.businessTypeName?(b=l.tomselect.getValue(),E=l.tomselect.options[l.tomselect.getValue()].text):i===e.hospiceSearch.businessTypeName?(b=g.tomselect.getValue(),E=g.tomselect.options[g.tomselect.getValue()].text):i===e.donationOrgSearch.businessTypeName?(b=S.tomselect.getValue(),E=S.tomselect.options[S.tomselect.getValue()].text):i===e.deathDoulaSearch.businessTypeName&&(b=w.tomselect.getValue(),E=w.tomselect.options[w.tomselect.getValue()].text);try{const t=await m.A.post(c,{"review-text":u,"review-rating":v,slug:b,flow:y,businessType:i});if(!t.ok)throw new m.o(t);L([d]),((t,s,i)=>{const r=document.querySelector(".review-success-message");t===e.funeralHomeSearch.businessTypeName?(n.classList.add("d-none"),e.businessesUserHasReviewed.funeralHomes.push(i)):t===e.cemeterySearch.businessTypeName?(a.classList.add("d-none"),e.businessesUserHasReviewed.cemeteries.push(i)):t===e.hospiceSearch.businessTypeName?(p.classList.add("d-none"),e.businessesUserHasReviewed.hospices.push(i)):t===e.donationOrgSearch.businessTypeName?(f.classList.add("d-none"),e.businessesUserHasReviewed.donationOrgs.push(i)):t===e.deathDoulaSearch.businessTypeName&&(q.classList.add("d-none"),e.businessesUserHasReviewed.deathDoulas.push(i)),o.classList.add("d-none");const l=document.querySelector(".business-1"),c=document.querySelector(".business-2"),d=document.querySelector(".business-2-wrapper");(0,h.dK)(r)?(r.classList.remove("d-none"),l.innerText=s):(d.classList.remove("d-none"),c.innerText=s)})(i,E,b),r()}catch(e){window.Rollbar.error("Error while submitting business review",e),d.parentNode.parentNode.querySelector(".errorlist").classList.remove("d-none"),r()}};s.addEventListener("change",k),i.addEventListener("change",k),l.addEventListener("change",k),d.addEventListener("change",k),g.addEventListener("change",k),v.addEventListener("change",k),S.addEventListener("change",k),b.addEventListener("change",k),w.addEventListener("change",k),I.addEventListener("change",k),r.addEventListener("click",(()=>{x(r,e.funeralHomeSearch.businessTypeName)})),u.addEventListener("click",(()=>{x(u,e.cemeterySearch.businessTypeName)})),y.addEventListener("click",(()=>{x(y,e.hospiceSearch.businessTypeName)})),E.addEventListener("click",(()=>{x(E,e.donationOrgSearch.businessTypeName)})),A.addEventListener("click",(()=>{x(A,e.deathDoulaSearch.businessTypeName)})),k(),document.querySelectorAll(".async-review-form").forEach((e=>{const t=new(c())(e.querySelector(".collapsed-submit-wrapper"),{toggle:!1});e.querySelector("textarea").addEventListener("focus",(()=>{t.show()})),e.querySelector("textarea").addEventListener("focusout",(e=>{e.currentTarget.value||t.hide()}))}))}(e)}var w=o(1435),I=o(5244),A=o(6430);function k(e){(0,A.A)(e.element,{allowInput:!0,altFormat:"l, F j, Y h:i K",altInput:!0,enableTime:!0,onChange(e,t,o){o._previousInput=o._input.value},onClose(e,t,o){o.config.allowInput&&o._input.value&&o._input.value!==o._previousInput&&o.setDate(o._input.value,!0,o.config.altFormat)},onReady(e,t,o){o._previousInput=o._input.value}})}var x=o(5260),C=o(4274),_=o(5920),P=o(2903);const F="Example: We're planning a celebration of life sometime in June in Chicago. I'll add more details as soon as we lock down a date.",$=e=>{document.querySelectorAll(".edit-events-container").forEach((t=>{t.querySelectorAll("input, textarea, select").forEach((t=>{t.tomselect?e?t.tomselect.disable():t.tomselect.enable():t.disabled=e}))}))},B=e=>{const t=document.getElementById(`id_form-${e}-event_type_other_title`),o=t.parentElement.querySelector('[value="0"]');t.addEventListener("click",(()=>{o.checked=!0}))},M=e=>{const t=e.querySelector(".event-type"),o=()=>{const o=t.querySelector('input[type="radio"]:checked'),n=e.querySelector(".event-name");if(o&&n){const e=document.getElementById(`id_${o.getAttribute("name")}_other_title`),t="0"===o.value?e.value:document.querySelector(`label[for=${o.getAttribute("id")}] .radio-label-text`).innerText;t?(n.innerText=t,n.classList.remove("empty")):(n.innerText="New Event",n.classList.add("empty")),"0"===o.value?e.setAttribute("required","required"):e.removeAttribute("required")}};t.querySelectorAll('input[type="radio"]').forEach((e=>{e.addEventListener("click",o)})),t.querySelector('input[type="text"]').addEventListener("input",o),o()},T=(e,t,o)=>{(0,x.A)({element:e,metadataElement:t,options:{types:["establishment","geocode"]},alwaysBlockReturnKeySubmit:o})},O=e=>{const t=e.querySelector(".event-rsvps-enabled-checkbox"),o=e.querySelector(".rsvps-limit-container");if(!t||!o)return;const n=c().getOrCreateInstance(o,{toggle:!1}),s=e.querySelector(".event-rsvps-limit-checkbox"),i=e.querySelector(".rsvps-limit-field-container"),r=i.querySelector('[type="number"]'),a=c().getOrCreateInstance(i,{toggle:!1}),l=()=>{if(t.checked?n.show():n.hide(),s.checked){if(!r.value){const e=r.getAttribute("min");r.value=e?Number.parseInt(e,10):10}a.show()}else r.value=null,a.hide()};t.addEventListener("change",l),s.addEventListener("change",l),l()},U=e=>{const t=e.querySelector(".event-stream-enabled-checkbox"),o=e.querySelector(".event-zoom-enabled-checkbox"),n=e.querySelector(".event-streaming-url-container"),s=e.querySelector(".event-zoom-data-container"),i=e.querySelector(".event-location-label"),r=()=>{t.checked||o.checked?-1===i.textContent.indexOf(" (optional for streams)")&&(i.textContent=i.textContent.concat(" (optional for streams)")):i.textContent=i.textContent.replace(" (optional for streams)","")};t.addEventListener("click",(e=>{r(),e.target.checked?n.classList.remove("d-none"):n.classList.add("d-none")})),o.addEventListener("click",(e=>{r(),e.target.checked?s.classList.remove("d-none"):s.classList.add("d-none")}))},D=(e,t)=>{let o;if(e){const n=e.querySelector(".toggle-covid-precautions"),s=e.querySelector(".event-covid-precautions");n&&s&&n.addEventListener("click",(()=>{n.classList.add("d-none"),s.classList.remove("d-none")}));const i=e.querySelector(".covid-precaution-other-container");if(i){const e=i.querySelector('input[type="checkbox"]'),t=i.querySelector(".covid-precaution-other-label"),o=i.querySelector(".covid-precaution-other-field-container");e.addEventListener("change",(()=>{t.classList.toggle("d-none",e.checked),o.classList.toggle("d-none",!e.checked),e.checked||(o.querySelector('input[type="text"]').value="")}))}const r=e.querySelector(".program-attachment-field"),a=e.querySelector('input[type="file"]'),l=e.querySelector(".download-program-link"),c=e.querySelector(".program-attachment-remove-field"),d=e.querySelector(".remove-program-input");a&&a.addEventListener("change",(e=>{const{files:t}=e.currentTarget;t&&t[0]&&(d.value=null,c.classList.remove("d-none"))}));const u=e.querySelector(".program-text-cta"),m=e.querySelector(".program-text-container");if(u&&m){u.addEventListener("click",(()=>{u.classList.add("d-none"),m.classList.remove("d-none")}));const e=m.querySelector("textarea");window.eljs.editor.initEditor({editor:{customButtons:["h2","h3"],inputId:e.id,inputContainerSelector:".program-text-container",templates:null,templatesContainerSelector:null},userMention:t.userMention})}const h=e.querySelector(".participants-input");if(h){const n=h.querySelector("select"),s=h.querySelector('input[type="hidden"]'),i={participantsInitialAutocompleteData:t.participantsInitialAutocompleteDataByEvent[e.dataset.uuid],participantsInputIds:{participants:n.id,participantsJson:s.id},userMention:t.userMention};o=(0,C.A)(i)}c&&c.querySelector(".remove-program-attachment").addEventListener("click",(()=>{a&&(a.value=null),d&&(d.value=!0),l&&l.classList.add("d-none"),c.classList.add("d-none"),r.classList.remove("d-none")}))}return o},N=(e,t=!1)=>{const o=e.parentElement.parentElement.querySelector(".rsvps-details");e.classList.add("d-none"),o.classList.remove("d-none"),t&&(0,P._c)(o,-340)};function R(e,t){const o=`Example: ${e.memorialFirstName} did not want a funeral service, but we appreciate all the love and support and encourage everyone to share their favorite memories of ${e.memorialFirstName} on this memorial website.`,n=`Example: ${e.memorialFirstName} requested a small service with immediate family only, but we appreciate everyone's love and support and encourage everyone to share their favorite memories of ${e.memorialFirstName} on this memorial website.`,s=document.querySelector(".change-timezone-container"),i=document.querySelector(".bottom-submit-row"),r=document.querySelector(".top-submit-row");e.eventsState===e.eventsStatePublic?$(!1):$(!0);const a=document.querySelector(".events-state-non-public .other-reason");let l="";a&&(e.eventsState===e.eventsStatePrivate?a.setAttribute("placeholder",n):e.eventsState===e.eventsStateNotHappening?a.setAttribute("placeholder",o):e.eventsState===e.eventsStatePending&&a.setAttribute("placeholder",F),l=a.value);const c=document.querySelector('.private-event-stream input[type="checkbox"]'),d=document.querySelector(".private-event-stream .stream-entry");c&&d&&c.addEventListener("change",(e=>{d.classList.toggle("d-none",!e.target.checked)}));const u=document.querySelector('.private-event-zoom input[type="checkbox"]'),m=document.querySelector(".private-event-zoom .event-zoom-data-container");u&&m&&u.addEventListener("change",(e=>{m.classList.toggle("d-none",!e.target.checked)})),document.querySelectorAll('.event-state-selection-wrapper input[type="radio"]').forEach((t=>{t.addEventListener("change",(t=>{const a=t.target;e.eventsState===e.eventsStatePublic&&a.value!==`${e.eventsStatePublic}`&&document.querySelector(".event-delete-warning").classList.remove("d-none"),$(a.value!==`${e.eventsStatePublic}`),document.querySelectorAll(".events-state-non-public .private-event-stream, .events-state-non-public .private-event-zoom").forEach((t=>{t.classList.toggle("d-none",a.value!==`${e.eventsStatePrivate}`)}));const c=document.querySelector(".events-state-non-public .other-reason");if(a.value===`${e.eventsStatePublic}`){document.querySelectorAll(".events-state-non-public, .events-state-pending, .events-state-no-info, .event-delete-warning").forEach((e=>{e.classList.add("d-none")})),document.querySelectorAll(".edit-events-containers, .add-event-container").forEach((e=>{e.classList.remove("d-none")})),r&&r.classList.add("d-none"),i&&i.classList.remove("d-none");const t=document.querySelectorAll(".edit-events-containers .edit-events-container").length;document.querySelectorAll(".remove-event").forEach((e=>e.classList.toggle("d-none",t<=1))),e.hideTimezone||s.classList.remove("d-none")}else[`${e.eventsStatePrivate}`,`${e.eventsStateNotHappening}`].includes(a.value)?(a.value===`${e.eventsStatePrivate}`?(c.setAttribute("placeholder",n),c.value=e.eventsState===e.eventsStatePrivate&&l?l:""):(c.setAttribute("placeholder",o),c.value=e.eventsState===e.eventsStateNotHappening&&l?l:""),document.querySelectorAll(".edit-events-containers, .add-event-container, .events-state-pending, .events-state-no-info").forEach((e=>e.classList.add("d-none"))),document.querySelector(".events-state-non-public").classList.remove("d-none"),r&&r.classList.remove("d-none"),i&&i.classList.add("d-none"),e.hideTimezone||s.classList.add("d-none")):a.value===`${e.eventsStatePending}`?(c.setAttribute("placeholder",F),c.value=e.eventsState===e.eventsStatePending&&l?l:"",document.querySelectorAll(".edit-events-containers, .add-event-container, .events-state-no-info, .private-event-stream, .private-event-zoom").forEach((e=>e.classList.add("d-none"))),document.querySelectorAll(".events-state-pending, .events-state-non-public").forEach((e=>e.classList.remove("d-none"))),r&&r.classList.remove("d-none"),i&&i.classList.add("d-none"),e.hideTimezone||s.classList.add("d-none")):a.value===`${e.eventsStateNoInfo}`&&(document.querySelectorAll(".edit-events-containers, .add-event-container, .events-state-non-public, .events-state-pending").forEach((e=>e.classList.add("d-none"))),document.querySelector(".events-state-no-info").classList.add("d-none"),r&&r.classList.remove("d-none"),i&&i.classList.add("d-none"),e.hideTimezone||s.classList.add("d-none"))}))})),document.querySelectorAll(".datetime-input").forEach((e=>{k({element:e});const t=e.nextElementSibling;t.addEventListener("input",(()=>{t.value||(e.value="")}))}));const h=Array.from(document.querySelectorAll(".edit-events-container")).map((t=>(U(t),O(t),D(t,e)))).filter((e=>e));t=[...t,...h],document.querySelectorAll(".remove-event a").forEach((e=>{e.addEventListener("click",(o=>{const n=e.closest(".edit-events-container").querySelector('input[type="hidden"]');if(n&&n.value&&window.confirm("Are you sure you want to delete this event?")){t.length>=1&&t.forEach((e=>e()));const n=e.closest("form");o.currentTarget.previousElementSibling.checked=!0,n.setAttribute("data-dirty-track-is-submitting","1"),n.action="?dr=1&edit-events=1",n.submit()}}))})),document.querySelectorAll(".show-rsvps").forEach((e=>{e.addEventListener("click",(()=>{N(e)}))})),e.attendeeFormsetProps&&Object.keys(e.attendeeFormsetProps).forEach((t=>{const o=e.attendeeFormsetProps[t];(0,_.R)(t,o)}))}function H(e,t){const o=document.getElementsByClassName("location-autocomplete");let{totalFormCount:n}=e;const s=document.getElementById("id_form-TOTAL_FORMS");s.value=n;const i=document.querySelector(".bottom-submit-row");for(let e=0;e<o.length;e+=1)T(o[e],document.getElementById(`id_form-${e}-location_metadata`)),B(e);const r=e=>{const t=/form-([0-9]+)-[A-Za-z_]+/,o=parseInt(e.getAttribute("name").match(t)[1],10);o<parseInt(s.value,10)&&document.querySelectorAll(".edit-events-container").forEach((e=>{const n=parseInt(e.querySelector('input[type="hidden"]').getAttribute("name").match(t)[1],10);n>o&&(e.querySelectorAll("input").forEach((e=>{e.name.includes(`-${n}-`)&&(e.setAttribute("name",e.getAttribute("name").replace(`-${n}-`,`-${n-1}-`)),e.setAttribute("id",e.getAttribute("id").replace(`-${n}-`,`-${n-1}-`)))})),e.querySelectorAll("label").forEach((e=>{e.getAttribute("for").includes(`-${n}-`)&&e.setAttribute("for",e.getAttribute("for").replace(`-${n}-`,`-${n-1}-`))})))})),document.querySelectorAll(".remove-event").forEach((e=>e.classList.toggle("d-none",n<=1)))};document.querySelectorAll(".edit-events-container").forEach((e=>{const o=e.querySelector('input[type="hidden"]');o&&!o.value&&e.querySelectorAll(".remove-event a").forEach((e=>e.addEventListener("click",(()=>{t.length>=1&&t.forEach((e=>e())),e.closest(".edit-events-container").remove(),n-=1,s.value=n,r(o)})))),M(e)})),document.querySelectorAll(".add-event-button").forEach((a=>a.addEventListener("click",(()=>{n+=1;const a=e.emptyForm.replace(/__prefix__/g,n-1),l=[...(0,h.t9)(a)],c=document.querySelector(".edit-events-containers");c.append(...l);const d=l[0];document.querySelectorAll(".remove-event").forEach((e=>e.classList.toggle("d-none",n<=1))),s.value=n;const u=D(c.querySelector(".edit-events-container:last-of-type"),e);void 0!==u&&t.push(u),d.querySelectorAll(".remove-event a").forEach((e=>e.addEventListener("click",(()=>{t.length>=1&&t.forEach((e=>e()));const o=e.closest(".edit-events-container");M(o);const i=o.querySelector('input[type="hidden"]');i&&!i.value&&(o.remove(),n-=1,s.value=n,r(i))}))));const m=document.getElementById(`id_form-${n-1}-location_metadata`);T(o[n-1],m,!0),k({element:`#id_form-${n-1}-start`}),k({element:`#id_form-${n-1}-end`}),O(d),U(d),M(d),B(n-1),i&&i.classList.remove("d-none")}))));const a=new URLSearchParams(window.location.search).get("expand-rsvp-details");if(a){const e=document.querySelector(`.edit-events-container[data-uuid='${a}']`).querySelector(".show-rsvps");e&&N(e,!0)}}var z=o(5643),j=o.n(z),V=o(7316);class G{constructor(e,t){this.root=e,this.rootModal=u().getOrCreateInstance(e),this.selectedStockPhotos=[],this.desiredCount=null,this.confirmSelection=this.root.querySelector(".confirm-selection"),this.cancelSelection=this.root.querySelector(".cancel-selection"),document.body.addEventListener("htmx:afterSettle",(e=>{e.detail.elt.classList.contains("stock-photo-browser")&&(e.detail.elt.querySelectorAll(".stock-photo").forEach((e=>{e.addEventListener("click",(()=>{this.togglePhoto(e)}))})),this.updateSelected())})),this.confirmSelection.addEventListener("click",(()=>{t(this.selectedStockPhotos),this.rootModal.hide()})),this.cancelSelection.addEventListener("click",(()=>{t([]),this.rootModal.hide()}))}show(e=null,t=null){this.desiredCount=t&&e?e.length+t:null,this.selectedStockPhotos=e||[];const o=this.root.querySelector(".stock-photo-browser");o&&(0,h.$I)(o,"loadStockPhotos"),this.rootModal.show()}togglePhoto(e){const{hashid:t,thumbnailUrl:o}=e.dataset,n=this.selectedStockPhotos.filter((e=>e.hashid!==t));n.length===this.selectedStockPhotos.length?this.selectedStockPhotos.push({hashid:t,thumbnailUrl:o}):this.selectedStockPhotos=n,this.updateSelected()}updateSelected(){const e=this.root.querySelector(".selected-photos");if(e){for(;e.firstChild;)e.removeChild(e.lastChild);e.append(...this.selectedStockPhotos.map((e=>{const t=document.createElement("img");t.setAttribute("src",e.thumbnailUrl);const o=document.createElement("div");o.classList.add("ratio","ratio-4x3"),o.dataset.hashid=e.hashid,o.dataset.thumbnailUrl=e.thumbnailUrl,o.append(t);const n=document.createElement("a");n.setAttribute("href","javascript:;"),n.innerText="-",o.append(n);const s=document.createElement("div");return s.append(o),s})));const t=this.selectedStockPhotos.map((e=>e.hashid));this.root.querySelectorAll(".stock-photo").forEach((e=>{e.classList.toggle("selected",t.includes(e.dataset.hashid))})),this.root.querySelector(".stock-photo-browser").classList.remove("full-selection"),this.selectedStockPhotos.length>0?(this.confirmSelection.innerText="Confirm Selection",this.confirmSelection.removeAttribute("disabled"),this.confirmSelection.classList.remove("disabled")):(this.confirmSelection.innerText="Select Photos",this.confirmSelection.setAttribute("disabled","disabled"),this.confirmSelection.classList.add("disabled"))}if(this.desiredCount){const e=this.root.querySelector(".desired-count-label");if(e){const t=this.desiredCount-this.selectedStockPhotos.length;e.classList.toggle("d-none",!t),e.innerText=t>0?`You can select ${t} more stock photo${1===t?"":"s"}.`:`You have selected ${Math.abs(t)} too many stock photos.`}}}}const W={aspectRatio:4/3,autoCrop:!0,autoCropArea:.8,viewMode:0,cropBoxMovable:!1,cropBoxResizable:!1,dragMode:"move",minCropBoxWidth:200,minCropBoxHeight:150,minCanvasHeight:150,zoomOnWheel:!0};class K{constructor(e){this.isOnboarding=e.isOnboarding,this.container=document.getElementById("deceased-photo-modal"),this.socialImporter=new V.k(document.getElementById("social-photo-importer"),(e=>{this.onSocialPhotosSelected(e)}),8);const t=document.getElementById("stock-photo-importer");t&&(this.stockPhotoModal=new G(t,(e=>{this.stockPhotosSelected(e)}))),this.isSelectingPhotos=!0,this.isInExternalPhotoSelection=!1,this.ingestionOptionsModal=document.getElementById("photo-ingestion-modal"),this.fileInput=this.container.querySelector('input[type="file"]'),this.fileInput.addEventListener("change",(()=>{this.filesSelected(this.fileInput.files)})),this.selectPhotosButton=this.ingestionOptionsModal.querySelector(".ingestion-option.upload"),this.selectPhotosButton.addEventListener("click",(()=>{this.fileInput.click()})),this.importFromFacebookButton=this.ingestionOptionsModal.querySelector(".ingestion-option.facebook"),this.importFromFacebookButton&&this.importFromFacebookButton.addEventListener("click",(()=>{this.isInExternalPhotoSelection=!0,this.render(),this.socialImporter.show(V.b.FACEBOOK)})),this.importFromEverLovedButton=this.ingestionOptionsModal.querySelector(".ingestion-option.stock-photos"),this.importFromEverLovedButton&&this.importFromEverLovedButton.addEventListener("click",(()=>{this.isInExternalPhotoSelection=!0,this.render(),this.stockPhotoModal.show(this.photos.filter((e=>e.hashid)).map((e=>({thumbnailUrl:e.url,hashid:e.hashid}))),this.collageSize-this.photos.length)})),this.layoutFrame=this.container.querySelector(".layout-frame"),this.layoutFrame.addEventListener("click",(e=>{const t=e.target.closest(".layout-selector");null!==t&&(this.collageSize=parseInt(t.dataset.layoutSize,10),this.isSelectingLayout=!1,this.isSelectingPhotos=0===this.photos.length,this.render())})),this.filterFrame=this.container.querySelector(".filter-frame"),this.filterFinishedButton=this.filterFrame.querySelector(".filter-finished"),this.filterFinishedButton.addEventListener("click",(()=>{this.isFiltering=!1,this.render()})),this.previewFrame=this.container.querySelector(".preview-frame"),this.existingPhotos=e.existingPhotos||[],this.photos=this.existingPhotos.slice(),this.cropperData={},this.isShowing=!1,this.saveButton=this.previewFrame.querySelector(".save-photos-btn"),this.saveButton.addEventListener("click",(()=>{this.saveButton.disabled||this.uploadPhotos()})),this.onPhotosUpdated=e.onPhotosUpdated,this.uploadUrl=e.uploadUrl,this.uploadExtraParams={is_onboarding:e.isOnboarding,fundraising_purpose:e.fundraisingPurpose},this.uploadOverlay=this.container.querySelector(".upload-overlay"),this.nextUrl=e.nextUrl,this.container.querySelector(".cancel-photo-selection").addEventListener("click",(()=>{this.photos=this.existingPhotos,this.cropperData={};const e=this.previewFrame.querySelector(".preview-photos");for(;e.hasChildNodes();)e.removeChild(e.lastChild);this.hide()})),this.collageSize=null,this.incompleteWarning=this.previewFrame.querySelector(".incomplete-warning"),this.incompleteWarning.classList.toggle("d-none",this.isOnboarding),this.incompleteWarning.querySelector(".invoke-stock-photo-selector").addEventListener("click",(()=>{this.isSelectingPhotos=!0,this.isInExternalPhotoSelection=!0,this.render(),this.stockPhotoModal.show(this.photos.filter((e=>e.hashid)).map((e=>({thumbnailUrl:e.url,hashid:e.hashid}))))})),this.previewFrame.querySelector(".select-different-layout").addEventListener("click",(()=>{this.collageSize=null,this.isSelectingLayout=!0,this.isSelectingPhotos=!1,this.socialImporter.activeImporter&&this.socialImporter.reset(),this.render()})),this.previewFrame.querySelector(".upload-photo").addEventListener("click",(()=>{this.startSelectPhotos()}))}show(e=!1){this.isShowing=!0,this.isInExternalPhotoSelection=!1,this.isSelectingLayout=null===this.collageSize,this.isSelectingPhotos=(0===this.photos.length||e)&&!this.isSelectingLayout,this.socialImporter.activeImporter&&this.socialImporter.reset(),this.render()}hide(){this.isShowing=!1,this.isSelectingLayout=!1,this.isSelectingPhotos=!1,this.isInExternalPhotoSelection=!1,this.collageSize=null,this.socialImporter.activeImporter&&this.socialImporter.reset(),this.render()}render(){const e=u().getOrCreateInstance(this.container),t=u().getOrCreateInstance(this.ingestionOptionsModal),o=this.previewFrame.querySelector(".preview-photos");o&&(o.dataset.collageSize=this.collageSize,this.isOnboarding&&o.classList.add("onboarding")),this.container.querySelectorAll(".layout-size").forEach((e=>{e.innerText=`${this.collageSize}`})),this.isShowing?this.isSelectingPhotos?this.isInExternalPhotoSelection?(e.hide(),t.hide()):(e.hide(),t.show()):(e.show(),t.hide(),this.isSelectingLayout?(this.filterFrame.classList.add("d-none"),this.previewFrame.classList.add("d-none"),this.layoutFrame.classList.remove("d-none"),this.renderLayoutFrame()):this.photos.length||this.existingPhotos.length?null!==this.collageSize&&this.photos.length>this.collageSize?(this.filterFrame.classList.remove("d-none"),this.previewFrame.classList.add("d-none"),this.layoutFrame.classList.add("d-none"),this.isFiltering=!0,this.renderFilterFrame()):(this.filterFrame.classList.add("d-none"),this.previewFrame.classList.remove("d-none"),this.layoutFrame.classList.add("d-none"),this.renderPreviewFrame()):(this.filterFrame.classList.add("d-none"),this.previewFrame.classList.add("d-none"),this.layoutFrame.classList.add("d-none"))):(e.hide(),t.hide(),this.isFiltering=!1)}stockPhotosSelected(e){e.forEach((e=>{0===this.photos.filter((t=>t.hashid===e.hashid)).length&&this.photos.push(e)})),this.photos.length&&(this.isSelectingPhotos=!1),this.render()}filesSelected(e){Array.from(e).forEach((e=>{0===this.photos.filter((t=>(t instanceof File||t.isFromSocial)&&t.name===e.name)).length?(e=>{const t=this.fileInput.getAttribute("accept").split(",").map((e=>e.trim()));return t.includes(e)||t.includes(`${e.split("/")[0]}/*`)})(e.type)?this.photos.push(e):alert(`Photo ${e.name} is an invalid file type.`):alert("This photo has already been selected. Please do not attempt to upload the same photo twice.")})),this.photos.length&&(this.isSelectingPhotos=!1),this.render(),this.fileInput.value=null}renderLayoutFrame(){(0,h.$I)(this.layoutFrame.querySelector(".deceased-photos-layout-editor"),"reloadPhotoLayouts")}renderFilterFrame(){const e=this.filterFrame.querySelector(".photo-tile-container");for(;e.firstChild;)e.removeChild(e.firstChild);this.photos.forEach((t=>{const o=document.createElement("div");o.classList.add("photo-tile"),o.dataset.photoName=t.name||t.uuid||t.hashid;const n=document.createElement("img");if(n.classList.add("photo"),o.appendChild(n),this.cropperData[t.name])n.style.objectFit="",n.src=this.cropperData[t.name].croppedCanvas;else if(n.style.objectFit="cover",n.style.objectPosition="center center",t instanceof File){const e=new FileReader;e.onload=()=>{n.src=`${e.result}`},e.readAsDataURL(t)}else n.src=t.url||t.thumbnailUrl;const s=document.createElement("a");s.classList.add("remove-tile-button"),s.href="javascript:;",s.innerHTML="&times;",s.addEventListener("click",(e=>{this.removePhoto(t),e.stopPropagation()})),o.appendChild(s),e.appendChild(o)}));const t=this.photos.length<=this.collageSize;this.filterFrame.querySelector(".alert").classList.toggle("d-none",t),this.filterFinishedButton.disabled=!t,this.filterFinishedButton.classList.toggle("disabled",!t)}renderPreviewFrame(){const e=this.previewFrame.querySelector(".preview-photos");e.querySelectorAll(".preview-photo.placeholder").forEach((e=>{e.remove()})),this.photos.forEach((t=>{const o=t.name||t.uuid||t.hashid;let n=e.querySelector(`[data-photo-name="${o}"]`);if(n){if(this.cropperData[t.name]){const e=n.querySelector("img.photo");e.style.objectFit="contain",e.style.objectPosition="center center",e.src=this.cropperData[t.name].croppedCanvas}}else{n=document.createElement("div"),n.classList.add("preview-photo","memorial-collage-grid-item"),n.dataset.photoName=o;const s=document.createElement("span");if(s.classList.add("primary-banner"),s.classList.add("badge"),s.classList.add("rounded-pill"),s.classList.add("text-bg-secondary"),s.innerHTML="PRIMARY PHOTO",n.appendChild(s),t instanceof File||t.isFromSocial){const e=document.createElement("div");e.classList.add("photo-controls","crop");const o=document.createElement("a");o.href="javascript:;",o.classList.add("preview-crop","mt-text-color-secondary","mt-border-color-secondary","border"),o.innerHTML="CROP",o.addEventListener("click",(()=>{this.cropPhoto(t)})),e.appendChild(o),n.appendChild(e)}const i=document.createElement("div");i.classList.add("photo-controls","move"),n.appendChild(i);const r=document.createElement("a");r.href="javascript:;",r.classList.add("preview-remove"),r.innerHTML="REMOVE",r.addEventListener("click",(e=>{this.removePhoto(t),e.stopPropagation()})),i.appendChild(r);const a=document.createElement("a");a.href="javascript:;",a.classList.add("preview-change"),a.innerHTML="CHANGE",a.addEventListener("click",(e=>{this.removePhoto(t),this.startSelectPhotos(),e.stopPropagation()})),i.appendChild(a);const l=document.createElement("a");l.href="javascript:;",l.innerHTML="&lt;",l.addEventListener("click",(()=>{this.movePhoto(t,!1)})),i.appendChild(l);const c=document.createElement("a");c.href="javascript:;",c.innerHTML="&gt;",c.addEventListener("click",(()=>{this.movePhoto(t,!0)})),i.appendChild(c);const d=document.createElement("img");if(d.classList.add("photo"),n.appendChild(d),e.appendChild(n),this.cropperData[t.name])d.style.objectFit="",d.src=this.cropperData[t.name].croppedCanvas;else if(d.style.objectFit="cover",d.style.objectPosition="center center",t instanceof File){const e=new FileReader;e.onload=()=>{d.src=`${e.result}`},e.readAsDataURL(t)}else d.src=t.url||t.thumbnailUrl}this.isOnboarding&&n.querySelector(".preview-remove").classList.toggle("d-none",this.photos.length<=1)}));let t=this.collageSize-this.photos.length;if(t>0){this.isOnboarding&&(t=1);for(let o=0;o<t;o+=1){const t=document.createElement("a");t.setAttribute("href","javascript:;"),t.classList.add("preview-photo","placeholder","memorial-collage-grid-item"),t.addEventListener("click",(()=>{this.startSelectPhotos()}));const o=document.createElement("img");o.setAttribute("src",this.container.dataset.cameraSvg),t.append(o,"Add Photo(s)"),e.append(t)}}this.incompleteWarning.classList.toggle("d-none",this.isOnboarding||t<=0),this.isOnboarding||(this.saveButton.classList.toggle("disabled",0!==t),0===t?(this.saveButton.removeAttribute("disabled"),this.saveButton.innerText="Save Changes"):(this.saveButton.setAttribute("disabled","disabled"),this.saveButton.innerText=`${t} space${1===t?"":"s"} left`))}startSelectPhotos(){this.isSelectingPhotos=!0,this.render()}async uploadPhotos(){const e=new FormData;Object.keys(this.uploadExtraParams).forEach((t=>{e.set(t,this.uploadExtraParams[t])})),this.photos.forEach(((t,o)=>{if(t instanceof File){e.append("photos",t);let n={is_main_photo:0===o,idx:o};if(this.cropperData[t.name]){const e=this.cropperData[t.name].cropData;n={x:e.x,y:e.y,width:e.width,height:e.height,...n}}e.set(t.name,JSON.stringify(n))}else if(t.isFromSocial){const n=this.cropperData[t.name];let s={is_main_photo:0===o,social_url:t.url,idx:o};n&&(s={x:n.x,y:n.y,width:n.width,height:n.height,...s}),e.set(t.name,JSON.stringify(s))}else e.set(t.uuid||t.hashid,JSON.stringify({is_main_photo:0===o,idx:o}))}));const{uploadOverlay:t}=this,o=this.uploadOverlay.querySelector(".el-progress > *"),n=this.photos.length,s=this.previewFrame.querySelector(".alert-warning");this.previewFrame.classList.add("uploading"),t.classList.remove("d-none"),s.classList.add("d-none");const i=e=>{if(o.value=e/2,e>=100){const e=setInterval((()=>{if(t.classList.contains("d-none")||!o)return void clearInterval(e);const n=parseInt(o.value,10);n<100?o.value=n+1:clearInterval(e)}),40*n)}};let r;try{r=await(0,P.UK)(this.uploadUrl,e,i)}catch(e){return window.Rollbar.error("Error uploading multi-DeceasedPhotos",e),this.previewFrame.classList.remove("uploading"),t.classList.add("d-none"),void s.classList.remove("d-none")}if(this.previewFrame.classList.remove("uploading"),o.value=0,t.classList.add("d-none"),this.nextUrl)window.location.href=this.nextUrl;else if(this.onPhotosUpdated){this.existingPhotos=r.data,this.photos=this.existingPhotos.slice(),this.cropperData={};const e=this.previewFrame.querySelector(".preview-photos");for(;e.hasChildNodes();)e.removeChild(e.lastChild);this.isSelectingPhotos=!0,this.onPhotosUpdated(r.data)}document.querySelectorAll(".deceased-photos-layout-editor").forEach((e=>{(0,h.$I)(e,"reloadPhotoLayouts")})),this.hide()}movePhoto(e,t=!0){const o=this.photos.indexOf(e);let n=o+(t?1:-1);if(n=Math.max(Math.min(this.photos.length-1,n),0),o===n)return;this.photos.splice(n,0,this.photos.splice(o,1)[0]);const s=this.previewFrame.querySelector(".preview-photos"),i=e.name||e.uuid||e.hashid,r=s.querySelector(`[data-photo-name="${i}"]`);r&&(t?s.insertBefore(r,r.nextSibling?r.nextSibling.nextSibling:null):o>0&&s.insertBefore(r,r.previousSibling))}removePhoto(e){this.photos=this.photos.filter((t=>t!==e));const t=e.name||e.uuid||e.hashid,o=this.previewFrame.querySelector(`[data-photo-name="${t}"]`);o&&o.remove(),this.photos.length?this.isFiltering?this.renderFilterFrame():this.renderPreviewFrame():this.render()}cropPhoto(e){let t;const o=document.createElement("div");o.classList.add("cropper-dvh100","position-fixed","top-0","left-0","w-100","h-100","d-flex","justify-content-stretch","align-items-stretch","flex-column","bg-black"),o.style.zIndex="9998";const n=document.createElement("img");n.classList.add("flex-shrink-1"),n.style.objectFit="contain",n.style.objectPosition="center center",n.style.flexBasis="calc(100% - 74px)",n.style.maxHeight="calc(100% - 74px)";const s=document.createElement("div");s.classList.add("zoom-controls","position-absolute","top-0","right-0","d-flex","m-3"),s.style.zIndex="9999";const i=document.createElement("a");i.setAttribute("href","javascript:;"),i.classList.add("zoom-control","zoom-in","rounded-circle","fw-bold","text-black","bg-white","d-flex","align-items-center","justify-content-center","m-1"),i.style.width="40px",i.style.height="40px",i.style.fontSize="36px",i.style.lineHeight="36px",i.innerText="",i.addEventListener("click",(()=>{t&&t.zoom(.1)}));const r=document.createElement("a");let a;r.setAttribute("href","javascript:;"),r.classList.add("zoom-control","zoom-in","rounded-circle","fw-bold","text-black","bg-white","d-flex","align-items-center","justify-content-center","m-1"),r.style.width="40px",r.style.height="40px",r.style.fontSize="36px",r.style.lineHeight="36px",r.innerText="",r.addEventListener("click",(()=>{t&&t.zoom(-.1)})),s.append(r,i),o.appendChild(s),this.cropperData[e.name]&&(a=this.cropperData[e.name].canvasData);const l={...W,ready(){if(a)this.cropper.setCanvasData(a);else{const e=t.getImageData(),o=t.getCropBoxData();t.zoom(Math.max(o.width/e.width,o.height/e.height)-1)}}};if(e instanceof File){const o=new FileReader;o.onload=()=>{n.src=`${o.result}`,t=new(j())(n,l)},o.readAsDataURL(e)}else n.src=e.url||e.thumbnailUrl,t=new(j())(n,l);o.appendChild(n);const c=document.createElement("div");c.classList.add("w-100","flex-grow-1","d-flex","justify-content-between","bg-white","p-2");const d=document.createElement("a");d.href="javascript:;",d.addEventListener("click",(()=>{o.remove()})),d.classList.add("btn","btn-lg","btn-outline-danger"),d.style.minWidth="0",d.innerText="Cancel",c.appendChild(d);const u=document.createElement("a");u.href="javascript:;",u.addEventListener("click",(()=>{this.cropperData[e.name]={canvasData:t.getCanvasData(),cropData:t.getData(),croppedCanvas:t.getCroppedCanvas().toDataURL("image/jpeg")},o.remove(),this.render()})),u.classList.add("btn","btn-lg","btn-primary"),u.style.minWidth="0",u.innerText="Crop",c.appendChild(u),o.appendChild(c),document.body.appendChild(o)}onSocialPhotosSelected(e){e.length?(this.isSelectingPhotos=!1,this.isInExternalPhotoSelection=!1,this.photos.push(...e.map((e=>({url:e,name:e,isFromSocial:!0}))))):(this.isSelectingPhotos=!0,this.isInExternalPhotoSelection=!0),this.render()}}var J=o(5550),Y=o.n(J),Z=o(1862),Q=o.n(Z),X=o(446);Y().define("virtual_scroll",Q());const ee=(e,t)=>{let{deceasedFirstName:o,deceasedLastName:n}=e;const s=document.querySelector(`#${e.deceasedNameFieldId}`),i=document.querySelector(`#${e.deceasedFirstNameFieldId}`),r=document.querySelector(`#${e.deceasedLastNameFieldId}`);if(t){if(document.querySelector(`.${e.manualEntryContainerClass}`).classList.remove("d-none"),document.querySelector(`.${e.memorialSearchContainerClass}`).classList.add("d-none"),!o&&!n){const e=s.value.split(" ");[o]=e,n=e.slice(1).join(" ")}s.value="",i.value=o,r.value=n}else document.querySelector(`.${e.manualEntryContainerClass}`).classList.add("d-none"),document.querySelector(`.${e.memorialSearchContainerClass}`).classList.remove("d-none"),i.value="",r.value=""},te=e=>{const t=document.getElementById(e.deceasedNameFieldId);if(!t)return null;const o=(t,o)=>{const n={search:t};n.page=o;const s=new URLSearchParams(n);return`${e.deceasedSearchUrl}?${s.toString()}`},n={plugins:["virtual_scroll"],valueField:"id",sortField:[{field:"$order"},{field:"$score"}],searchField:[],firstUrl(e){return o(e,1)},async load(e,t){try{const n=await m.A.get(this.getUrl(e));if(!n.ok)throw new m.o(n);const s=await n.json();if(s.pagination.next){const t=o(e,s.pagination.next);this.setNextUrl(e,t)}t(s.results)}catch(e){e.response&&429===e.response.status||window.Rollbar.error("TomSelect deceased search error",e),t()}},loadThrottle:500,placeholder:e.deceasedPlaceholder,render:{option:e=>{return(t=e).dateOfBirth?(0,X.q)(t.text,`${t.dateOfBirth} - ${t.dateOfDeath}`):(0,X.q)(t.text);var t},not_loading:e=>0===e.input.length?null:'<div class="no-results">Please enter the name.</div>'},shouldLoad:e=>e.length>=3,create:e=>({id:e.trim(),text:e.trim(),created:!0}),maxItems:1},s=new(Y())(t,n);s.on("change",(t=>{if(t){const o=s.options[t],n=document.getElementById(e.deceasedMemorialSlugFieldId);o.created?(ee(e,!0),n.value=""):n.value=o.id}})),e.initialAutocompleteData&&e.initialAutocompleteData.id&&(s.options[e.initialAutocompleteData.id]||s.addOption(e.initialAutocompleteData),s.setValue(e.initialAutocompleteData.id)),e.deceasedManualEntryErrors&&ee(e,!0),document.querySelector(`.${e.deceasedFormClass}`).querySelector(".close-button").addEventListener("click",(()=>{ee(e,!1),s.clear()}));const i=document.querySelector(`.${e.deceasedLocationContainerClass}`);return i&&(0,x.A)({element:i.querySelector("input"),options:{types:["(cities)"]}}),t},oe=e=>{const t=document.querySelector(`#${e.deceasedNameFieldId}`),o=document.querySelector(`#${e.deceasedFirstNameFieldId}`),n=document.querySelector(`#${e.deceasedLastNameFieldId}`),s=document.querySelector(`#${e.deceasedRelationshipTypeFieldId}`);function i(){const i=document.querySelector(`.${e.deceasedSubmitButton}`);s.value&&(t.value||o.value&&n.value)?i.disabled=!1:i.disabled=!0}t.tomselect&&t.tomselect.on("change",(()=>i())),s.addEventListener("change",(()=>{i()}))};var ne=o(5748),se=o(9213),ie=o(9927);function re(e,t=null){let o;e.personalFundraiserForms.forEach((n=>{let s=document.querySelector(`#${n.fields.fundraisingGoal}`);s&&(s=s.closest(".fundraising-goal-container"));const i=document.querySelector(`#${n.fields.fundraisingGoalDisabled}`);if(s&&i){const e=s.querySelector(".goal-amount-container"),t=s.querySelector(".currency-no-goal-container"),o=s.querySelector(".goal-container"),n=c().getOrCreateInstance(e,{toggle:!1});let r;t&&(r=c().getOrCreateInstance(t,{toggle:!1})),i.addEventListener("change",(()=>{n.toggle(),t&&r.toggle(),i.checked&&(o.parentElement.querySelector("input").value="")}))}const r=document.getElementById(n.fields.fundraisingGoal);r&&(o=new se.A(r,{numeral:!0,numeralPositiveOnly:!0}),t&&t(o),r.closest("form").addEventListener("submit",(()=>{r.value=o.getRawValue()})));const a=document.getElementById(n.fields.currencySelect),l=document.querySelector(".intl-currency-warning");if(a&&l){let t=a.selectedOptions[0].value;a.addEventListener("change",(()=>{const n=a.selectedOptions[0].value;if(l.classList.toggle("d-none","usd"===n),e.exchangeRates&&t!==n){const s=parseFloat(o.getRawValue()).toFixed(2);o.setRawValue(Math.round(s*e.exchangeRates[t][n])),t=n}}))}}));const n=document.querySelector(`#${e.causeStoryForm.fields.causeStory}`),s=document.querySelector(".cause-story-templates-container");(0,ie.A)(s,n,e.causeStoryTemplates,(()=>!0===e.shouldShowCauseStoryTemplates),!1,null,!1);const i=document.querySelector(`#${e.causeStoryForm.fields.previousCauseStory}`);i&&n.addEventListener("paste",(e=>{i.value=(e.clipboardData||window.clipboardData).getData("text")})),e.charityFundraiserForms.forEach((e=>{const t=document.querySelector(`#${e.fields.charityvestDesignation}`);if(t){const e=t.closest(".body-card").querySelector(".charityvest-designation-other");t.addEventListener("change",(()=>{e.classList.toggle("d-none",!("other_purpose"===t.value))}))}}));const r=document.getElementById("change-fundraising-manager");r&&r.addEventListener("change",(()=>{const e=r.selectedOptions[0];if(e&&!e.dataset.isOriginal){r.setAttribute("name","_change_fundraising_manager");const e=r.closest("form");e.dataset.forceSubmit="true",e.submit()}})),(0,h.xy)()}Y().define("virtual_scroll",Q());var ae=o(458),le=o(3530),ce=o.n(le);Y().define("remove_button",ce());var de=o(5190),ue=o(7914);function me(e){const t=document.querySelector(".memorial-notifications-modal"),o=u().getOrCreateInstance(t),n=t.querySelector(".btn-secondary");o.show(),n.addEventListener("click",(async()=>{o.hide();try{if(!(await m.A.post(e.sendNotificationsEndpoint)).ok)throw new Error}catch{window.Rollbar.error("Error sending memorial notifications to subscribers.")}}))}var he=o(4255),pe=o(5251),ge=o(0);function ve(e){const t=document.querySelector(".add-predeceased-button"),o=document.querySelector(".add-predeceased-form"),n=document.querySelector(".add-following-in-death-button"),s=document.querySelector(".add-following-in-death-form"),i=document.querySelector(".add-survivor-button"),r=document.querySelector(".add-survivor-form");if(t&&o){t.addEventListener("click",(()=>{t.classList.add("d-none"),o.classList.remove("d-none"),s&&s.classList.add("d-none"),r&&r.classList.add("d-none"),o.querySelectorAll("input,select").forEach((e=>{e.disabled=!1})),s&&s.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"})),r&&r.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"}))})),o.querySelector(".close-button").addEventListener("click",(()=>{t.classList.remove("d-none"),o.classList.add("d-none"),o.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"}))}));const e=document.querySelector(".predeceased-location-container");e&&(0,x.A)({element:e.querySelector("input"),options:{types:["(cities)"]}})}n&&s&&(n.addEventListener("click",(()=>{n.classList.add("d-none"),s.classList.remove("d-none"),o&&o.classList.add("d-none"),r&&r.classList.add("d-none"),s.querySelectorAll("input,select").forEach((e=>{e.disabled=!1})),o&&o.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"})),r&&r.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"}))})),s.querySelector(".close-button").addEventListener("click",(()=>{n.classList.remove("d-none"),s.classList.add("d-none"),s.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"}))}))),i&&r&&(i.addEventListener("click",(()=>{i.classList.add("d-none"),r.classList.remove("d-none"),s&&s.classList.add("d-none"),o&&o.classList.add("d-none"),r.querySelectorAll("input,select").forEach((e=>{e.disabled=!1})),s&&s.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"})),o&&o.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"}))})),r.querySelector(".close-button").addEventListener("click",(()=>{i.classList.remove("d-none"),r.classList.add("d-none"),r.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"}))})));const a=document.getElementById(e.survivorRelationshipTypeFieldId),l=document.querySelector(".survivor-relationship-other");a&&l&&a.addEventListener("change",(e=>{const t=e.target.selectedIndex;"other"===e.target.options[t].value?l.classList.remove("d-none"):(l.querySelector("input").value="",l.classList.add("d-none"))}));const c=document.querySelector('.survivor-invite-manager input[type="checkbox"]');c&&c.addEventListener("change",(()=>{document.querySelector(".survivor-invite-manager-disclaimer").classList.toggle("d-none",!c.checked),document.querySelector(".survivor-email-optional").classList.toggle("d-none",c.checked)}));const d=document.getElementById(e.predeceasedRelationshipTypeFieldId),u=document.querySelector(".predeceased-relationship-other");if(d&&u&&d.addEventListener("change",(e=>{const t=e.target.selectedIndex;"other"===e.target.options[t].value?u.classList.remove("d-none"):(u.querySelector("input").value="",u.classList.add("d-none"))})),e.followerFormProps){const t=document.getElementById(e.followerFormProps.deceasedRelationshipTypeFieldId),o=document.querySelector(".following-relationship-other");t&&o&&t.addEventListener("change",(e=>{const t=e.target.selectedIndex;"other"===e.target.options[t].value?o.classList.remove("d-none"):(o.querySelector("input").value="",o.classList.add("d-none"))}))}e.isOnboarding||function(e){const{baseSearchUrl:t,container:o,slugFieldId:n,firstNameFieldId:s,lastNameFieldId:i,excludeSlugs:r,predicateFilter:a}=e;if(!o)return;const l=o.querySelector(".memorial-search-entry"),c=o.querySelector(".memorial-search-loading"),d=o.querySelector(".memorial-search-result-container"),u=o.querySelector(".memorial-search-error"),h=o.querySelector(".memorial-search-duplicate"),p=o.querySelector(".memorial-search-ineligible"),g=o.querySelector(".manual-entry"),v=document.getElementById(n),y=document.getElementById(s),f=document.getElementById(i),S=o.querySelector('[type="submit"]'),b=e=>{if(c.classList.add("d-none"),e){if(a&&!a(e))return p.classList.remove("d-none"),d.classList.add("d-none"),l.classList.remove("d-none"),void(g?g.classList.remove("d-none"):S&&S.setAttribute("disabled","disabled"));if(r&&r.includes(e.slug))return h.classList.remove("d-none"),d.classList.add("d-none"),l.classList.remove("d-none"),void(g?g.classList.remove("d-none"):S&&S.setAttribute("disabled","disabled"));d.classList.remove("d-none"),g?g.classList.add("d-none"):S&&S.removeAttribute("disabled"),d.querySelector(".memorial-image").src=e.photo,d.querySelector(".name").innerText=e.name,d.querySelector(".location").innerText=e.location||"",e.yearOfBirth?d.querySelector(".years").innerText=`${e.yearOfBirth} - ${e.yearOfDeath}`:d.querySelector(".years").innerText="--",v.value=e.slug,y.value=e.firstName,f.value=e.lastName}else d.classList.add("d-none"),l.classList.remove("d-none"),u.classList.remove("d-none"),g?g.classList.remove("d-none"):S&&S.setAttribute("disabled","disabled")};l&&(l.querySelector("input").addEventListener("paste",(e=>{(async e=>{l.classList.add("d-none"),c.classList.remove("d-none"),d.classList.add("d-none"),u.classList.add("d-none"),p.classList.add("d-none"),h.classList.add("d-none");const o=`${t}?url=${encodeURIComponent(e)}`;try{const e=await m.A.get(o);if(!e.ok)throw new m.o(e);const t=await e.json();b(t)}catch(e){window.Rollbar.warn("Error searching memorial by URL",e),b(null)}})((e.clipboardData||window.clipboardData).getData("text"))})),o.querySelector(".clear-search-result").addEventListener("click",(()=>{v.value="",y.value="",f.value="",d.classList.add("d-none"),l.classList.remove("d-none"),g?g.classList.remove("d-none"):S&&S.setAttribute("disabled","disabled")})))}({baseSearchUrl:e.memorialSearchUrl,container:o,excludeSlugs:e.relatedMemorialSlugs,slugFieldId:e.predeceasedMemorialSlugFieldId,firstNameFieldId:e.predeceasedMemorialDeceasedFirstNameFieldId,lastNameFieldId:e.predeceasedMemorialDeceasedLastNameFieldId});const h=document.querySelectorAll(".person-edit-form");h&&h.forEach((e=>{const t=e.querySelector("select"),o=e.querySelector(".edit-relationship-other");t.addEventListener("change",(e=>{const t=e.target.selectedIndex;"other"===e.target.options[t].value?(o.classList.remove("d-none"),o.querySelector("input").setAttribute("required","required")):(o.querySelector("input").value="",o.classList.add("d-none"),o.querySelector("input").removeAttribute("required"))}));const n=e.closest(".list-group-item"),s=n.querySelector(".person-edit-form"),i=n.querySelector(".list-item-content");e.querySelector(".cancel-edit-person").addEventListener("click",(()=>{s.classList.add("d-none"),i.classList.remove("d-none"),s.querySelectorAll("input,select").forEach((e=>{e.disabled="disabled"}))})),s.querySelectorAll("input").forEach((e=>{e.addEventListener("keydown",(e=>{13===e.keyCode&&(e.preventDefault(),s.querySelector("button").click())}))}))}));const p=document.querySelectorAll(".edit-person-link");p&&p.forEach((e=>{const t=e.closest(".list-group-item"),o=t.querySelector(".person-edit-form"),n=t.querySelector(".list-item-content");e.addEventListener("click",(()=>{o.classList.remove("d-none"),n.classList.add("d-none"),o.querySelectorAll("input,select").forEach((e=>{e.disabled=null}))}))}))}var ye=o(8250),fe=o(2037),Se=o(1432);function be(e){let{totalOtherFormCount:t}=e;const o=e=>{const o=e.querySelector('.need-title input[type="checkbox"]'),n=o.closest(".need-title").querySelector(".need-type-other-input"),s=()=>{const e=o.closest(".need-form-container").querySelector(".need-details");e&&e.classList.toggle("show",o.checked);const s=o.closest(".need-title").querySelector(".need-title-label"),i=o.closest(".need-title").querySelector(`#${o.id.replace("need_enabled","DELETE")}`),r=o.closest(".need-form-container").querySelector(`#${o.id.replace("need_enabled","id")}`);s&&n&&i&&(n.classList.toggle("d-none",!o.checked),s.classList.toggle("d-none",o.checked),o.checked&&n.focus(),r&&r.value?i.value=!o.checked:o.checked||(t-=1,o.closest(".need-form-container").remove(),document.querySelector("#id_need-other-TOTAL_FORMS").value=t));const a=o.closest(".need-title").querySelector('button[type="submit"]');a&&(a.classList.add("d-md-block"),r&&r.value&&!o.checked&&(a.innerText="Remove"))};o.addEventListener("change",s),n&&n.addEventListener("input",s),e.querySelectorAll(".edit-need-details").forEach((t=>{t.addEventListener("click",(()=>{const t=e.querySelector(".need-details-readonly"),o=e.querySelector(".need-details-editable");t.classList.add("d-none"),o.classList.remove("d-none")}))}));const i=e.querySelector(".need-location-field"),r=e.querySelector(".need-location-metadata-field");i&&r&&(0,x.A)({element:i,metadataElement:r,options:{types:["establishment","geocode"]}})};document.querySelectorAll(".need-form-container").forEach(o);const n=document.querySelector(".other-need-formset"),s=document.querySelector(".add-other-need");n&&s&&s.addEventListener("click",(()=>{t+=1;const s=e.emptyOtherForm.replace(/__prefix__/g,t-1),i=document.createElement("div");i.innerHTML=s;const r=i.firstElementChild;n.appendChild(r),o(r),r.querySelectorAll('[type="submit"]').forEach(h.c7),r.querySelector('input[type="checkbox"]').click(),r.querySelectorAll(".el-animated-placeholder-label-input input").forEach(h.Bn),document.querySelector("#id_need-other-TOTAL_FORMS").value=t})),(0,Se.A)()}function Le(e){e.showNotificationsPrompt&&me(e);const t=document.querySelector(".open-import-contacts-button"),o=document.querySelector(".modal-body-overlay.loading"),n=document.querySelector(".modal-body-overlay.connect-prompt"),s=document.querySelector(".modal-body-overlay.error"),i=document.querySelector(".contact-search"),r=document.querySelector(".contact-list-group"),a=document.querySelector(".import-contacts-button"),l=document.querySelector(".invite-recipients-field textarea"),c=document.querySelector(".select-all-contacts-button");if(i){i.addEventListener("input",(()=>{const e=i.value.toLowerCase();document.querySelector(".clear-contact-search").classList.toggle("d-none",!e),r.querySelectorAll(".list-group-item").forEach((t=>{const o=(t.getAttribute("data-name")+t.getAttribute("data-email")).toLowerCase(),n=!e||o.includes(e);t.classList.toggle("d-none",!n)}))})),document.querySelector(".clear-contact-search").addEventListener("click",(e=>{e.currentTarget.classList.add("d-none"),i.value="",r.querySelectorAll(".list-group-item").forEach((e=>{e.classList.remove("d-none")}))}));const d=async()=>{const t=(l.value||"").toLowerCase().split(",").map((e=>e.trim()));for(;r.firstChild;)r.removeChild(r.firstChild);let n;s.classList.add("d-none"),o.classList.remove("d-none"),a.classList.add("disabled");try{const t=await m.A.get(e.getContactsUrl);if(!t.ok)throw new m.o(t);n=await t.json()}catch(e){window.Rollbar.warn("Error getting Google contacts",e),o.classList.add("d-none"),s.classList.remove("d-none")}if(n){if(0===n.contacts.length){const e=document.createElement("div");e.setAttribute("class","list-group-item list-group-item-disabled"),e.innerText="You have no contacts attached to your Google account."}n.contacts.forEach((e=>{const o=document.createElement("a");o.setAttribute("href","javascript:;"),o.setAttribute("class","list-group-item list-group-item-action contact-list-group-item"),o.setAttribute("data-email",e.email),o.setAttribute("data-name",e.name),o.innerHTML=`<div class="checkbox"></div><div class="contact"><h5>${e.name}</h5><span>${e.email}</span></div>`,o.addEventListener("click",(()=>{o.classList.toggle("active"),document.querySelectorAll(".contact-list-group-item").length===document.querySelectorAll(".contact-list-group-item.active").length?(c.innerText="Deselect All",c.setAttribute("data-all-selected","true")):(c.innerText="Select All",c.removeAttribute("data-all-selected"))})),t.includes(e.email.toLowerCase())&&o.classList.add("active"),r.appendChild(o)})),c.classList.remove("d-none"),o.classList.add("d-none"),a.classList.remove("disabled")}};s.querySelector(".btn").addEventListener("click",(e=>{s.getAttribute("data-has-retried")?window.location=`${window.location.pathname}?clear-gauth=1`:(s.setAttribute("data-has-retried","true"),e.currentTarget.innerText="Error! Click to reload and reconnect to Google.",d())}));const h=document.querySelector("#import-google-contacts-modal");if(e.hasCredentials)h.addEventListener("show.bs.modal",(async()=>{await d()}));else{const e=document.querySelector(".oauth-initializer");e.addEventListener("click",(()=>{const t=document.querySelector(e.getAttribute("data-alternate"));t&&t.classList.contains("invisible")&&setTimeout((()=>{t.classList.remove("invisible")}),2e3);const o=e.getAttribute("data-oauth-url"),n=window.top.outerHeight/2+window.top.screenY-340,s=window.top.outerWidth/2+window.top.screenX-200;window.open(o,"OAuthWindow",`toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=400, height=680, top=${n}, left=${s}`)})),window.oAuthComplete=async()=>{n&&o&&(n.classList.add("d-none"),o.classList.remove("d-none")),await d()}}a&&a.addEventListener("click",(()=>{if(t.innerText="Add more imported contacts",!a.classList.contains("disabled")){const e=(l.value||"").toLowerCase().split(",").map((e=>e.trim())),t=Array.from(r.querySelectorAll(".list-group-item.active")).map((e=>e.getAttribute("data-email").toLowerCase())),o=Array.from(r.querySelectorAll(".list-group-item")).map((e=>e.getAttribute("data-email").toLowerCase())).filter((e=>!t.includes(e))),n=t.filter((t=>!e.includes(t.toLowerCase()))),s=e.filter((e=>!o.includes(e.toLowerCase()))).concat(n).filter((e=>e));l.value=`${s.join(", ")}`,u().getOrCreateInstance(h).hide()}})),c&&c.addEventListener("click",(()=>{c.getAttribute("data-all-selected")?document.querySelectorAll(".contact-list-group-item").forEach((e=>{e.classList.remove("active")})):document.querySelectorAll(".contact-list-group-item").forEach((e=>{e.classList.add("active")})),document.querySelectorAll(".contact-list-group-item").length===document.querySelectorAll(".contact-list-group-item.active").length?(c.innerText="Deselect All",c.setAttribute("data-all-selected","true")):(c.innerText="Select All",c.removeAttribute("data-all-selected"))}))}const d=document.querySelector(".invite-records-body-card");d&&d.querySelector(".toggle-collapse-invite-records").addEventListener("click",(()=>{d.classList.toggle("collapsed"),d.classList.contains("collapsed")?d.style.height=null:d.style.height=`${d.scrollHeight+40}px`}))}function Ee(e){re(e)}function qe(e){ve(e),document.querySelector(".add-survivor-form").querySelectorAll("input,select").forEach((e=>{e.disabled=!1}))}function we(e){const t=[];R(e,t),H(e,t)}function Ie(e){ve(e)}function Ae(e){q(e),(0,w.A)(e.causeOfDeathSearch),(0,x.A)({element:document.getElementById("id_business_association-remains_location"),metadataElement:document.getElementById("id_business_association-remains_location_metadata"),options:{types:["establishment","geocode"]}})}function ke(){const e=document.querySelector('input[name="_fundraising_choice"]'),t=document.querySelectorAll(".fundraising-guidance-option");e&&t.length&&t.forEach((t=>{t.addEventListener("click",(()=>{e.value=t.dataset.fundraisingChoice,e.closest("form").submit()}))}))}function xe(e){const t=new K(e.deceasedPhotoUploaderProps);document.querySelector(".start-select-photos").addEventListener("click",(()=>{t.show()})),window.fbAsyncInit=()=>{window.FB.init({appId:ge.A.facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:ge.A.facebookApiVersion})}}var Ce=o(7576),_e=o.n(Ce);const Pe=async e=>{try{const t=await m.A.post(e.updateSharingChecklistEndpoint,{"sharing-checklist-item":"share_to_facebook"});if(!t.ok)throw new m.o(t)}catch(e){window.Rollbar.error("Error updating the sharing checklist from onboarding",e.statusText)}};function Fe(e){new(_e())(".btn-copy").on("success",(e=>{e.trigger.innerText="Copied!"})),window.fbAsyncInit=()=>{window.FB.init({appId:ge.A.facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:ge.A.facebookApiVersion}),document.querySelectorAll(".btn-facebook-share").forEach((t=>{t.addEventListener("click",(()=>{ge.A.debug&&console.log(`Would share the following link to Facebook: ${e.facebookShare.href}`),window.FB.ui(e.facebookShare,(t=>{t&&!t.error_code&&void 0!==t&&(e.memorialHasPersonalFundraiser&&!e.shareToFacebookChecklistStatus?(Pe(e),window.location.href=e.shareComplete):window.location.href=e.shareComplete)}))}))}))}}class $e{constructor(e){this.root=e,this.target=document.getElementById(this.root.dataset.wordCountTarget),this.max=parseInt(this.root.dataset.wordCountMax,10),this.counterSpan=this.root.querySelector(".word-counter-count"),this.target&&this.max&&this.target.addEventListener("input",(()=>{this.assessCount()}))}assessCount(){const e=this.getWordCount(),t=e-this.max;t>0?(this.counterSpan.innerText=`${e}/${this.max}`,(0,h.$I)(this.root,"elwc:overage")):(this.counterSpan.innerText=`${e}/${this.max}`,(0,h.$I)(this.root,"elwc:compliance")),this.counterSpan.classList.toggle("overage",t>0),this.counterSpan.classList.toggle("warning",t>=-10&&t<=0)}getWordCount(){return this.target.value.split(/\s/).filter((e=>e.length>0)).length}}function Be(e){const t=document.getElementById(e.form.fields.photoUrl),o=document.querySelector(".selected-photo"),n=document.querySelectorAll(".photo-selector-choices > img");t&&o&&n.length&&n.forEach((e=>{e.addEventListener("click",(()=>{n.forEach((e=>{e.classList.remove("selected")})),e.classList.add("selected"),e.classList.contains("no-photo")?(t.value="",o.src="",o.classList.add("d-none")):(t.value=e.src,o.src=e.src,o.classList.remove("d-none"))}))}));const s=document.querySelector(".partner-obituary-order-create-form");let i=!1;s.addEventListener("submit",(e=>{i&&(e.stopPropagation(),e.preventDefault())}));const r=e=>{i=!e,s.querySelectorAll('[type="submit"]').forEach((t=>{t.disabled=!e,t.classList.toggle("disabled",!e)}))},a=document.querySelector(`.word-counter[data-word-count-target="${e.form.fields.obituary}"]`);a&&(new $e(a).assessCount(),a.addEventListener("elwc:overage",(()=>{r(!1)})),a.addEventListener("elwc:compliance",(()=>{r(!0)})));const l=document.getElementById(e.form.fields.obituary);l&&new f(l),(0,ye.A)(e)}function Me(e){!function(e){(0,S.A)(e.charitySearch);const t=document.getElementById(e.charitySearch.businessIdentifierInputId),o=document.querySelector(".btn-submit-typed-charity"),n=document.querySelector(".charity-search-helper-modal");t.tomselect.on("change",(e=>{if(e){const s=t.tomselect.options[e];s.created&&(n.querySelector(".cause-name-input").value=s.id,u().getOrCreateInstance(n).show()),o.classList.remove("d-none")}}))}(e),function(){const e=document.querySelectorAll(".cause-card"),t=document.querySelectorAll(".cause-card .cause-expander"),o=document.querySelectorAll(".rectangle");t.forEach((t=>{t.addEventListener("click",(()=>{const n=t.closest(".cause-card"),s=n.querySelector(".cause-card-expander"),i=n.querySelector(".rectangle"),r=n.classList.contains("is-expanded");o.forEach((e=>{e.classList.toggle("d-none",i!==e||r)})),e.forEach((e=>{e.classList.toggle("is-expanded",e===n&&!r),e.classList.toggle("is-collapsed",e!==n||r),e.style.marginBottom=e!==n||r?"20px":`${s.offsetHeight+20}px`})),(0,h.PA)(n,-80,!1,window.isOnMobile?document.scrollingElement:n.closest(".private-content-container")||document.scrollingElement)}))}))}(),function(){function e(e){const t=e.target.closest(".cause-card-expander");t.closest(".cause-card").style.marginBottom=`${t.offsetHeight+20}px`}(0,Se.A)(),document.querySelectorAll(".cause-description").forEach((t=>{t.addEventListener("shown.bs.collapse",e),t.addEventListener("hidden.bs.collapse",e)}))}()}const Te={"cause-name":"cause-name-change-after-launch","cause-url":"cause-website-change-after-launch","cause-type":"sympathy-gift-type-change-after-launch"},Oe={"cause-name":"The cause name can't be changed if there are outstanding pledges to the cause.","cause-url":"The cause website address can't be changed if there are outstanding pledges to the cause.","cause-type":"The type of sympathy gift can't be changed if there are outstanding pledges to the cause."},Ue=5e3;function De(e){const t=document.querySelector(`#${e}`);if(t){let e;try{e=window.Intl.DateTimeFormat().resolvedOptions().timeZone}catch{e=null}if(e){const o=Array.from(t.options).find((t=>t.value===e));o&&t.insertBefore(o,t.firstElementChild.nextElementSibling)}}}async function Ne(e,t){try{const o=await m.A.post(t,{"sharing-checklist-item":e,"sharing-checklist-value":1});if(!o.ok)throw new m.o(o)}catch{return}document.querySelectorAll(`[data-alert-key="${e}"]`).forEach((e=>{e.remove()}))}const Re="el-sidebar-hidden";class He{constructor(e){this.sidebar=e,this.storageAvailable=(0,h.VS)("sessionStorage")}isShowing(){return!this.sidebar.classList.contains("hidden")}sync(){const e="true"===window.sessionStorage.getItem(Re);this.sidebar.classList.toggle("hidden",e)}show(){this.storageAvailable?(window.sessionStorage.setItem(Re,"false"),this.sync()):this.sidebar.classList.remove("hidden")}hide(){this.storageAvailable?(window.sessionStorage.setItem(Re,"true"),this.sync()):this.sidebar.classList.add("hidden")}toggle(){this.storageAvailable?this.isShowing()?this.hide():this.show():this.sidebar.classList.toggle("hidden")}}function ze(){document.querySelectorAll(".remove-memorial-update").forEach((e=>{e.addEventListener("click",(async()=>{if(window.confirm("Are you sure you want to delete this update? Subscribers will not be notified.")){const t=e.getAttribute("data-delete-url");e.innerHTML="Removing...";try{const e=await m.A.delete(t);if(!e.ok)throw new m.o(e)}catch{return void(e.innerHTML="Removing failed.")}e.closest(".memorial-update-container").remove()}}))}))}function je(e){if(e.hasPremium){if(e.disableMemorialGiftsId){const e=document.querySelectorAll(".disable-memorial-gifts-container");e.length>0&&e.forEach((t=>{const o=t.querySelector('input[type="checkbox"]'),n=()=>{const t=document.querySelector(".gift-toggles"),n=t.querySelector(".disable-memorial-gifts-container"),s=document.querySelectorAll(".cause-configuration-container"),i=document.querySelector(".memorial-gifts-display-preferences-container"),r=document.querySelector(".standalone-story-and-checklist"),a=document.querySelector(".full-width-add-fundraiser-button");t&&s&&(t.classList.toggle("gifts-hidden",o.checked),s.forEach((e=>{e.parentElement.classList.toggle("d-none",o.checked)})),n.classList.toggle("d-none",!o.checked),i.classList.toggle("d-none",o.checked),r&&r.classList.toggle("d-none",o.checked),a&&a.classList.toggle("d-none",o.checked)),e.forEach((e=>{e.querySelector('input[type="checkbox"]').checked=o.checked}))};o.addEventListener("change",n),n()}))}if(e.disableMemorialGiftListDisplayId){const t=document.getElementById(e.disableMemorialGiftListDisplayId),o=document.getElementById(e.disableMemorialGiftContributionsDisplayId);if(t){const e=()=>{t.checked?(o.checked=!0,o.disabled=!0):o.disabled=!1},n=e=>{const t=e.closest("form");t&&e&&t.addEventListener("submit",(()=>{e.disabled&&(e.disabled=!1)}))};t.addEventListener("change",e),e(),n(o)}}}}function Ve(e){e.showNotificationsPrompt&&me(e),e.userMention&&(0,pe.dH)(e);const t=document.querySelector(".private-sidebar");if(t){const e=t.querySelector(".sidebar-toggle"),o=new He(t);o.sync(),e&&e.addEventListener("click",(()=>{o.toggle()})),Array.from(document.querySelectorAll(".errorlist")).some((e=>null!==e.offset))&&o.hide(),t.querySelectorAll(".sidebar-nav .nav-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),o.hide(),window.location.href=e.currentTarget.href}))}))}(0,h.ZT)(),(0,h.pf)(e),function(e){e.hasPremium||document.querySelectorAll(".premium-preference-toggle.disabled").forEach((e=>{e.querySelector(".click-capture-overlay").addEventListener("click",(()=>{u().getOrCreateInstance(".premium-upsell-modal").show()}))}))}(e),function(){const e=new URLSearchParams(window.location.search);if(e.get("timezone-added")||e.get("timezone-changed")||e.get("timezone-removed")){const t=document.getElementsByClassName("timezone-modal-text")[0];e.get("timezone-added")?t.innerHTML="This timezone will now be displayed throughout this memorial website.":e.get("timezone-changed")?t.innerHTML="Your memorial website and any event times have been updated to reflect this new timezone. If you have memorial events listed, please check to ensure the times shown are what you intended.":t.innerHTML="The timezone has been removed from this memorial website. If you have memorial events listed, please check to ensure the times shown are what you intended.",u().getOrCreateInstance(".timezone-selection-modal").show()}}(),(0,P.SR)(),window.fbAsyncInit=()=>{window.FB.init({appId:ge.A.facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:ge.A.facebookApiVersion}),document.querySelectorAll(".btn-facebook-share").forEach((t=>{t.addEventListener("click",(()=>{ge.A.debug&&console.log(`Would share the following link to Facebook: ${e.sharingUrl}`),window.FB.ui({method:"share",href:e.sharingUrl},(t=>{t&&!t.error_code&&void 0!==t&&Ne("share_to_facebook",e.updateSharingChecklistEndpoint)}))}))}))},(0,ae.A)("#sidebar-mobile-actions-share .btn-native-share"),document.querySelectorAll(".autocomplete-sharing-checklist-item").forEach((t=>{t.addEventListener("click",(()=>{Ne(t.dataset.alertKey,e.updateSharingChecklistEndpoint)}))}));const o=document.querySelector(".private-all-alerts"),n=document.querySelector(".show-all-alerts");n&&n.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),e.isPrivateDashboard&&o&&null==o.offsetParent?(o.classList.remove("d-none"),o.classList.add("full-screen")):((0,P._c)(o),o.classList.add("expand-alerts"),t.classList.add("hidden"))})),e.isPrivateDashboard&&"#all-alerts"===window.location.hash&&o&&null==o.offsetParent&&(o.classList.remove("d-none"),o.classList.add("full-screen"));const s=document.querySelector(".close-alerts");s&&s.addEventListener("click",(()=>{o.classList.add("d-none"),o.classList.remove("full-screen")}));const r=document.querySelectorAll(".dismiss-alert-button");if(r&&r.forEach((t=>{t.dataset.alertKey&&t.addEventListener("click",(async()=>{const o=(0,h.SE)(t),n=t.closest(".list-group-item");let s;try{const o=await m.A.post(e.dismissPrivateAlertUrl,{key:t.dataset.alertKey});if(!o.ok)throw new m.o(o);s=await o.json()}catch{return void o()}s&&(s.success?n.remove():t.innerText="Error")}))})),e.autoScrollTargets){const o=()=>{Object.keys(e.autoScrollTargets).forEach((o=>{if(window.location.hash===o){const n=document.querySelector(e.autoScrollTargets[o]);n&&((0,P._c)(n,-240),t.classList.add("hidden"))}}))};window.onhashchange=o,o()}const a=document.querySelector(".exit-onboarding-wizard");if(a){const e=i().getOrCreateInstance(a);a.querySelector(".btn-close").addEventListener("htmx:afterRequest",(()=>{e.close()}))}!function(e){const t=document.querySelector("#memorialFeatureSearchModal"),o=document.getElementById(e.searchPhraseInputId);if(!o)return null;const n=(t,o)=>{const n={search:t};n.page=o;const s=new URLSearchParams(n);return e.memorialFeatureSearchUrl.includes("?")?`${e.memorialFeatureSearchUrl}&${s.toString()}`:`${e.memorialFeatureSearchUrl}?${s.toString()}`},s={sortField:[{field:"$order"},{field:"$score"}],searchField:[],firstUrl(e){return n(e,1)},async load(e,t){try{const o=await m.A.get(this.getUrl(e));if(!o.ok)throw new m.o(o);const s=await o.json();if(s.pagination.next){const t=n(e,s.pagination.next);this.setNextUrl(e,t)}t(s.results)}catch(e){e.response&&429===e.response.status||window.Rollbar.error("TomSelect memorial feature search error",e),t()}},loadThrottle:500,placeholder:'Try "Events"',plugins:["virtual_scroll"],valueField:"id"},i=new(Y())(o,s);i.on("change",(e=>{const o=i.options[e];u().getOrCreateInstance(t).hide(),window.location.href=o.url})),t.addEventListener("shown.bs.modal",(()=>{i.open()}))}(e.memorialFeatureSearch),(0,h.xy)(),(0,h.Dc)()}function Ge(e){const t=document.querySelector(".person-count"),{emptyForm:o}=e.invitePeopleFormset,n=document.getElementById(e.invitePeopleFormset.totalFormsFieldId);let s=e.invitePeopleFormset.total;const i=e=>{const t=e.querySelector(".relationship-entry");e.querySelectorAll('[type="radio"]').forEach((e=>{e.addEventListener("change",(()=>{const o=e.checked&&"True"===e.value;t.classList.toggle("d-none",!o)}))}))},r=(e,t)=>{e&&t&&e.addEventListener("change",(e=>{const o=e.target.selectedIndex;"other"===e.target.options[o].value?t.classList.remove("d-none"):(t.querySelector("input").value="",t.classList.add("d-none"))}))},a=()=>{const e=document.querySelector("#invite-people-btn");if(t.innerText=`${s} pe${1===s?"rson":"ople"}`,1===s){const t=document.querySelectorAll(".name-entry input"),o=document.querySelector(".email-entry input");e.disabled=!(Array.from(t).every((e=>e.value))&&o.value)}else e.disabled=!1},l=e=>{s+=e,n.value=s,a()},c=e=>{const t=e.currentTarget.closest(".invite-person-survivor-form");t&&(l(-1),t.remove())};document.querySelectorAll(".invite-person-survivor-form.first input").forEach((e=>{e.addEventListener("input",(()=>{a()}))})),document.querySelectorAll(".invite-person-survivor-form").forEach((e=>{const t=e.querySelector("select"),o=e.querySelector(".survivor-relationship-other");r(t,o),i(e)})),document.querySelectorAll(".remove-invite-person-form").forEach((e=>{e.addEventListener("click",c)}));const d=document.querySelector(".add-invite-person-btn");d&&d.addEventListener("click",(()=>{const e=d.parentElement,t=s;l(1);const n=document.createElement("div");n.classList.add("add-survivor-form"),n.classList.add("invite-person-survivor-form"),n.innerHTML=o.replace(/__prefix__/g,t),e.insertBefore(n,d),n.querySelector(".remove-invite-person-form").addEventListener("click",c);const a=n.querySelector("select"),u=n.querySelector(".survivor-relationship-other");r(a,u),i(n)}))}function We(e){const t=document.querySelector(".creator-recommendations-carousel-wrapper");t&&new n.Ay(t.querySelector(".glide"),{animationDuration:600,peek:{before:20,after:20},type:"carousel"}).mount({Swipe:n.Hp}),(0,I.A)({initialAutocompleteData:e.initialAutocompleteData,cityIdentifierInputId:"id_memorial-city_slug",citySearchUrl:e.citySearchUrl}),document.querySelectorAll(".answer-text").forEach((e=>{const t=e.closest(".carousel-item").querySelector(".collapse");e.addEventListener("focus",(()=>{c().getOrCreateInstance(t,{toggle:!1}).show()}))}));const o=document.querySelector(".memorial-community-questions .carousel");o&&(new(a())(o),o.querySelectorAll(".previous-btn, .next-btn, .carousel-indicators").forEach((e=>{e.addEventListener("click",(()=>{const t=e.closest(".carousel").querySelector(".collapse.show");t&&c().getOrCreateInstance(t,{toggle:!1}).hide()}))}))),(0,he.A)();let s=!1;const i=document.querySelector(".memorial-community-questions form");i&&i.addEventListener("submit",(e=>{e.preventDefault();const t=[...i.querySelectorAll("button")].find((e=>(0,h.zN)(e)));t&&(document.getElementById("id_submitted_question_index").value=t.value,s||(s=!0,i.submit()))})),document.querySelectorAll(".sent-thank-you-checkbox").forEach((e=>{e.addEventListener("click",(async t=>{t.preventDefault();const o=t.currentTarget;let n;o.disabled=!0;try{const t=await m.A.post(e.dataset.updateUrl,{toggle_thank_you:!0});if(!t.ok)throw new m.o(t);n=await t.json()}catch{o.disabled=!1}n&&(o.disabled=!1,o.checked=n.sentThankYou)}))}));const r=document.querySelector(".checklist-progress-container");r&&new ue.A(r,e.checklistProgress),e.tourProps&&function(e){if(window.innerWidth<1e3)return;const{tourData:t,containerSelector:o}=e,n=document.querySelector(o);let[s]=t;if(n){let e,o=!1;const i=()=>{document.querySelectorAll(".tour-target").forEach((e=>{e.classList.remove("tour-target")})),document.querySelectorAll(".tour-step").forEach((e=>{e.classList.add("d-none")})),n.classList.add("d-none")},r=()=>{document.querySelectorAll(".tour-step").forEach((e=>{e.classList.add("d-none");const t=document.querySelector(`[data-tour-target-for="${e.id}"]`);t&&t.classList.toggle("tour-target",e.id===s.id)}));const t=document.getElementById(s.id);if(t)if(s.alone)t.style.position="absolute",t.style.width="33%",t.style.left="33%",t.style.top="25%",t.classList.remove("d-none");else{const o=document.querySelector(`[data-tour-target-for="${t.id}"]`);o?((0,h.cH)(o)||o.scrollIntoView(!1),setTimeout((()=>{const e=o.getBoundingClientRect(),n=e.left,s=e.left+e.width,i=e.top,r=e.top+e.height;let a,l,c,d;t.style.position="absolute",t.style.left=null,t.style.right=null,t.style.top=null,t.style.bottom=null,i>window.innerHeight-r?(c=window.innerHeight-i,d="bottom"):(c=r,d="top"),n>window.innerWidth-s?(a=window.innerWidth-n,l="right"):(a=s,l="left"),a>c?(t.style.setProperty(l,`${a}px`),t.style.top=`${i}px`):(t.style.setProperty(d,`${c}px`),t.style.left=`${n}px`),t.classList.remove("d-none"),window.innerHeight-t.getBoundingClientRect().bottom<60&&(t.style.top=null,t.style.bottom="0")}),150)):e()}};e=()=>{const e=t.indexOf(s);e+1>=t.length?([s]=t,i()):(s=t[e+1],r())};const a=()=>{n.classList.remove("d-none"),r(),o=!0};document.querySelectorAll(".tour-next").forEach((t=>{t.addEventListener("click",(()=>{e()}))})),document.querySelectorAll(".tour-exit").forEach((e=>{e.addEventListener("click",(()=>{i()}))}));const l=()=>{o||a()};let c=setTimeout(l,Ue);document.addEventListener("mousemove",(()=>{c&&(clearTimeout(c),c=null),o||(c=setTimeout(l,Ue))})),document.addEventListener("visibilitychange",(()=>{c&&(clearTimeout(c),c=null),document.hidden||o||setTimeout(l,Ue)}))}}(e.tourProps),e.invitePeopleFormset&&Ge(e)}function Ke(e){!function(e){const{titleInputId:t,titleOtherStrInputId:o,suffixInputId:n,suffixOtherStrInputId:s}=e;if(t&&o&&n&&s){const t=document.querySelector(`#${e.titleInputId}`),o=document.querySelector(`#${e.titleOtherStrInputId}`).parentNode;t.addEventListener("change",(e=>{"other"===e.target.value?o.classList.remove("d-none"):o.classList.add("d-none")}));const n=document.querySelector(`#${e.suffixInputId}`),s=document.querySelector(`#${e.suffixOtherStrInputId}`).parentNode;n.addEventListener("change",(e=>{"other"===e.target.value?s.classList.remove("d-none"):s.classList.add("d-none")}))}}(e);const t=document.querySelector(".add-nickname");t.addEventListener("click",(()=>{t.nextElementSibling.classList.remove("d-none"),t.classList.add("d-none")}));const o=document.querySelectorAll(".date-of-death-input-group select");function n(){o.forEach((e=>{e.selectedIndex=null,e.classList.add("disabled-input"),e.removeAttribute("required")}))}function s(){o.forEach((e=>{e.classList.remove("disabled-input"),e.setAttribute("required","")}))}const i=document.getElementById(e.notYetPassedInputId);if(i.addEventListener("change",(()=>{i.checked?n():s()})),o.forEach((e=>{e.addEventListener("click",(()=>{i.checked&&(s(),i.checked=!1)}))})),i.checked&&n(),e.relationshipSelectId){const t=document.getElementById(e.relationshipSelectId),o=document.querySelector(".relationship-other");t&&o&&t.addEventListener("change",(e=>{const t=e.target.selectedIndex;"other"===e.target.options[t].value?o.classList.remove("d-none"):(o.querySelector("input").value="",o.classList.add("d-none"))}))}(0,x.A)({element:document.getElementById("id_deceased-location_str"),options:{types:["(cities)"]}})}function Je(e){Ke(e);const t=document.querySelector(".photos-uploaded-banner"),o=new K({onPhotosUpdated:()=>{t&&t.classList.remove("d-none")},...e.deceasedPhotoUploaderProps}),n=document.querySelector(".memorial-deceased-form-photos");n&&n.addEventListener("click",(e=>{null!==e.target.closest(".layout-selector")&&(t.classList.add("d-none"),o.show(!1))}))}function Ye(e){q(e),(0,w.A)(e.causeOfDeathSearch),function(e){const{checkboxId:t,initialAutocompleteData:o,inputId:n}=e,s=document.querySelector(`#${t}`),i=document.querySelector(`#${n}`),r=i.closest(".donated-organs-details-container"),a={hidePlaceholder:!0,sortField:[{field:"$order"},{field:"$score"}],items:o.choices.filter((e=>e.selected)).map((e=>e.id)),options:o.choices,placeholder:"Ex. Heart",plugins:{remove_button:{title:"Remove this item"}},valueField:"id"};new(Y())(i,a);function l(){s.checked?r.classList.remove("d-none"):r.classList.add("d-none")}s&&r&&s.addEventListener("change",(()=>{l()})),l()}(e.organDonationSearch),(0,x.A)({element:document.getElementById("id_business_association-remains_location"),metadataElement:document.getElementById("id_business_association-remains_location_metadata"),options:{types:["establishment","geocode"]}})}function Ze(e,t,o){(0,x.A)({element:e,metadataElement:t,options:{componentRestrictions:{country:["ca","us"]},types:["address"]},alwaysBlockReturnKeySubmit:o})}function Qe(e){re(e,(t=>{e.fundraisingGoalCleave=t}));const{causeStoryForm:t}=e;if(e.isNewCause){const e=document.querySelector(`#${t.fields.causeStory}`);if(e){const t=e.value;e.defaultValue="must-edit-me!",e.value=t}}const o=document.querySelector(".clear-fundraising-user-link");o&&o.addEventListener("click",(()=>{const e=document.getElementById(o.dataset.clearInput);e.value=1;const t=e.closest("form");t&&t.requestSubmit()})),document.querySelectorAll(".show-error-on-click").forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.disabledName,o=(0,h.qP)(e,".errorlist");if(o){const n=Oe[t];e.parentElement.append(...(0,h.t9)(`<ul class="errorlist"><li>${n}</li></ul>`)),o.classList.remove("d-none")}const n=Te[t];(0,h.Wl)(window.location.href,"memorial edit info",n)}),{once:!0})})),je({disableMemorialGiftsId:e.premiumForm.fields.disableMemorialGifts,disableMemorialGiftListDisplayId:e.premiumForm.fields.disableMemorialGiftListDisplay,disableMemorialGiftContributionsDisplayId:e.premiumForm.fields.disableMemorialGiftContributionsDisplay,...e}),e.charityFundraiserForms.forEach((e=>{const t=document.querySelector(`#${e.fields.selfServeDonations}`);if(t){const e=t.closest(".body-card"),o=e.querySelector(".custom-charity-fine-print"),n=e.querySelector(".self-serve-charity-fine-print"),s=e.querySelector(".fundraising-user-selection"),i=()=>{n.classList.toggle("d-none",!t.checked),o.classList.toggle("d-none",t.checked),s&&s.classList.toggle("d-none",!t.checked)};t.addEventListener("change",i),i()}})),function(e){const t=document.querySelector(".delivery-addresses-formset-container"),o=t.getElementsByClassName("location-autocomplete"),n=t.querySelector(".add-address-container"),s=document.querySelector(".delivery-address-forms"),i=document.getElementById(e.deliveryAddressesTotalFormCountInputId);let r=e.deliveryAddressesTotalFormCount;function a(e){e.addEventListener("click",(()=>{e.querySelector('input[type="checkbox"]').checked=!0,e.parentElement.classList.add("d-none");const t=e.previousElementSibling.querySelector('input[type="hidden"]');t&&!t.value&&(r-=1,i.value=r,e.remove())}))}n.querySelector("button").addEventListener("click",(()=>{r+=1,i.value=r,s.insertAdjacentHTML("beforeend",e.emptyDeliveryAddressForm.replace(/__prefix__/g,r-1)),Ze(o[r-1],document.getElementById(`id_delivery_addresses-${r-1}-location_metadata`),!0),a(s.lastElementChild.querySelector(".remove-address"))}));const l=document.getElementById(e.preferencesFormFieldIds.allowFlowers);l.addEventListener("change",(()=>{l.checked?t.classList.remove("d-none"):t.classList.add("d-none")}));for(let e=0;e<o.length;e+=1)Ze(o[e],document.getElementById(`id_delivery_addresses-${e}-location_metadata`));s.querySelectorAll(".remove-address").forEach((e=>{a(e)}))}(e),ze()}function Xe(){(0,ne.D)()}function et(e){const t=e=>{const t=e.target,o=t.closest(".list-container"),n=o.querySelector(".user-scroll-container"),s=o.querySelector(".empty"),i=s.querySelector(".no-search"),r=s.querySelector(".empty-search");let a=!0;o.querySelectorAll(".blockable-user").forEach((e=>{e.getAttribute("data-search-string").toLowerCase().includes(t.value.toLowerCase())?(a=!1,e.classList.remove("d-none")):e.classList.add("d-none")})),a?(s.classList.remove("d-none"),n.classList.add("d-none"),t.value?(r.classList.remove("d-none"),i.classList.add("d-none")):(r.classList.add("d-none"),i.classList.remove("d-none"))):(s.classList.add("d-none"),n.classList.remove("d-none"))},o=document.querySelectorAll(".user-blocking-container > div");o&&o.forEach((e=>{const o=e.querySelector(".search-field");o.addEventListener("keyup",t),o.addEventListener("paste",t),t({target:o})}));const n=document.querySelectorAll(".block-user-button"),s=document.querySelector(".blocked-user-list .user-scroll-container"),i=document.querySelector(".unblocked-user-list .user-scroll-container");n.forEach((o=>{o.addEventListener("click",(async()=>{const n=(0,h.SE)(o),r="1"===o.getAttribute("data-block"),a=o.closest(".list-group-item");try{const t=await m.A.post(e.blockUrl,{user:o.getAttribute("data-block-user"),block:r});if(!t.ok)throw new m.o(t)}catch{return void n()}o.innerText=r?"Unblock":"Block",o.setAttribute("data-block",r?"0":"1"),(r?s:i).appendChild(a),document.querySelectorAll(".search-field").forEach((e=>{t({target:e})})),n()}))}))}function tt(e){ve(e),function(e){const t=document.querySelectorAll(".edit-related-photo-link"),o=document.querySelector('input[name="_upload_related_person_photo"]'),n=o.closest("form"),s=n.querySelector('input[type="file"]');t.forEach((e=>{e.addEventListener("click",(()=>{s.dataset.toPerson=e.dataset.toPerson,e.dataset.memorial?s.dataset.memorial=e.dataset.memorial:s.removeAttribute("data-memorial"),s.click()}))})),(0,de.A)({photoInput:document.querySelector(`#${e.relatedPhotoForm.fields.rawPublicProfilePhoto}`),xInput:document.querySelector(`#${e.relatedPhotoForm.fields.x}`),yInput:document.querySelector(`#${e.relatedPhotoForm.fields.y}`),heightInput:document.querySelector(`#${e.relatedPhotoForm.fields.height}`),widthInput:document.querySelector(`#${e.relatedPhotoForm.fields.width}`),cropperOptions:{viewMode:0,cropBoxMovable:!1,cropBoxResizable:!1,dragMode:"move",minCropBoxWidth:373,minCropBoxHeight:280,minCanvasHeight:280,aspectRatio:1},cropButtonSubmits:!0,onComplete:()=>{o.value=s.dataset.toPerson,n.submit()},onModalShown:e=>{s.dataset.memorial?e.setAspectRatio(4/3):e.setAspectRatio(1)}})}(e),function(){let e=null;const t=document.querySelectorAll("a.awaiting-confirmation-alert"),o=document.querySelectorAll(".added-by-others");o.length&&(e=o[0]),t.forEach((t=>{t&&e&&(t.href="#",t.addEventListener("click",(()=>{(0,P._c)(e)})))}))}(),function(e){te(e),oe(e)}(e.followerFormProps)}function ot(e){const t=[];R(e,t),H(e,t),De(e.forms.timezone.fields.timezone)}function nt(e){if(e&&e.placeholderOverride){const t=document.querySelector(".edit-obituary textarea");t&&t.setAttribute("placeholder",e.placeholderOverride)}const t=[];document.querySelectorAll(".el-autosave").forEach((e=>{t.push(new f(e))}));const o=document.querySelector(".show-templates"),n=document.querySelector(".obituary-templates-container-container");o&&n&&(n.classList.add("d-none"),o.addEventListener("click",(()=>{n.classList.remove("d-none")})))}function st(e){const t=document.getElementById(e.noteInputId),o=document.querySelector(".note-templates-container"),n=e.noteTemplates;(0,ie.A)(o,t,n,null,!0,null,!1)}function it(){const e=document.querySelector(".password-protect-toggle input"),t=document.querySelector(".password-field-container");e&&t&&e.addEventListener("change",(()=>{e.checked?t.classList.remove("d-none"):t.classList.add("d-none")}))}async function rt(e){it(),je(e),et(e),await(0,ye.A)(e),await async function(e){const t=await(0,fe.c)(e.stripePublishableKey);document.body.addEventListener("initAddPaymentMethod",(e=>{const o=document.getElementById("manage-payment-method");if(!o)return;document.querySelectorAll('input[name="payment_method"][type="radio"]').forEach((e=>{e.addEventListener("change",(()=>{e.checked&&document.querySelectorAll(".payment-method-select-listener").forEach((e=>{window.htmx.trigger(e,"paymentMethodSelected")}))})),e.checked&&document.querySelectorAll(".payment-method-select-listener").forEach((e=>{window.htmx.trigger(e,"paymentMethodSelected")}))}));const n=t.elements({appearance:{theme:"stripe",variables:{colorPrimary:getComputedStyle(document.body).getPropertyValue("--primary-brand-color")||"#7f465c",fontFamily:"Lato"},labels:"floating"},clientSecret:e.detail.clientSecret,fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Lato:300,400,700"}],loader:"always"}),s={base:{fontFamily:"Lato",fontSize:"18px","::placeholder":{color:"#8e8e8e"}},invalid:{color:"#c30c30"}},i=n.create("cardNumber",{style:s}),r=n.create("cardExpiry",{style:s}),a=n.create("cardCvc",{style:s});i.mount("#stripe-card-element"),r.mount("#stripe-exp-element"),a.mount("#stripe-cvc-element"),i.addEventListener("change",(e=>{const t=document.getElementById("stripe-card-errors");e.error?(t.textContent=e.error.message,t.classList.remove("d-none")):(t.textContent="",t.classList.add("d-none"))})),r.addEventListener("change",(e=>{const t=document.getElementById("stripe-exp-errors");e.error?(t.textContent=e.error.message,t.classList.remove("d-none")):(t.textContent="",t.classList.add("d-none"))})),a.addEventListener("change",(e=>{const t=document.getElementById("stripe-cvc-errors");e.error?(t.textContent=e.error.message,t.classList.remove("d-none")):(t.textContent="",t.classList.add("d-none"))}));const l=document.getElementById("cardholder-name"),c=document.getElementById("zip"),d=document.getElementById("save-card");d.addEventListener("click",(async n=>{n.preventDefault(),n.stopPropagation();const s=(0,h.SE)(d),r={billing_details:{address:{postal_code:c.value},name:l.value},card:i},a=await t.confirmCardSetup(e.detail.clientSecret,{payment_method:r});if(a.error){if(a.error.message){const e=document.getElementById("payment-method-errors");e.innerText=a.error.message,e.classList.remove("d-none")}else window.Rollbar&&window.Rollbar.error("Error confirming PaymentMethod setup",a.error);s()}else o.setAttribute("hx-vals",JSON.stringify({setup_intent:a.setupIntent.id})),(0,h.$I)(o,"paymentMethodAdded")}))}))}(e),document.body.addEventListener("htmx:afterSettle",(e=>{const t="premium-checkout"===e.detail.elt.id?e.detail.elt:null;t&&(0,h.$p)(t)}))}function at(e){it(),document.querySelectorAll(".remove-manager-link").forEach((e=>{e.addEventListener("click",(async()=>{if(window.confirm("Are you sure you want to remove this manager?")){const t=e.getAttribute("data-delete-url");e.innerHTML="Removing...";try{const e=await m.A.delete(t);if(!e.ok)throw new m.o(e)}catch{return void(e.innerHTML="Removing failed.")}e.closest(".list-group-item").remove()}}))}));const t=document.querySelectorAll(".memorial-theme-option"),o=Array.from(t).map((e=>e.dataset.themeName));t.forEach((e=>{const t=e.querySelector('input[type="radio"]');t&&t.addEventListener("change",(()=>{o.forEach((e=>{document.body.classList.toggle(e,e===t.closest(".memorial-theme-option").dataset.themeName&&t.checked)})),document.body.classList.add("theme")}))})),De(e.forms.timezone.fields.timezone)}function lt(e){window.location.href=e.urls[window.location.hash]||e.defaultUrl}function ct(e){const t=document.getElementById(e.reasonCommentFieldId);document.querySelectorAll(`input[name="${e.reasonInputName}"]`).forEach((o=>{o.addEventListener("change",(()=>{t.setAttribute("placeholder",e.reasonCommentFormPrompts[o.value]),t.classList.remove("d-none")}))}))}function dt(e){const t=document.getElementById(e.noteInputId),o=document.querySelector(".note-templates-container"),n=e.noteTemplates;(0,ie.A)(o,t,n,null,!0,null,!1),ze()}function ut(e){(0,g.r)();const t=document.querySelector(".modal-belonging-editor");if(t){const o=e=>t=>{if(t.currentTarget.classList.contains("add-belonging"))e.showForBelonging(null);else{const{name:o,description:n,isPublished:s,isClaimed:i,belonging:r,photo:a}=t.currentTarget.dataset;e.showForBelonging({name:o,description:n,photo:a,isPublished:"true"===s,isClaimed:"true"===i,id:r})}},n=(t,n)=>{const s=document.querySelector(".listed-belongings .belongings-list"),i=document.querySelector(".unlisted-belongings .belongings-list"),r=document.querySelector(`.belonging[data-belonging="${t.id}"]`),a=t.is_published?s:i;let l=a.querySelector(".belonging.add-belonging");r&&(r.parentElement===a&&(l=r.nextSibling),r.remove());const c=document.createElement("div"),d=`${t.description.slice(0,30)}${t.description.length>30?"...":""}`;c.innerHTML=e.emptyListItem.replace(/__name__/g,t.name).replace(/__description__/g,d).replace(/__photo__/g,t.photo);const u=c.firstChild;u.classList.toggle("claimed",t.is_claimed),u.dataset.belonging=t.id,u.dataset.name=t.name,u.dataset.description=t.description,u.dataset.isPublished=t.is_published?"true":"false",u.dataset.isClaimed=t.is_claimed?"true":"false";const m=u.querySelector(".claimed-badge");m&&m.classList.toggle("d-none",!t.is_claimed),a.insertBefore(u,l),u.addEventListener("click",o(n))},s=new p(t,{...e.editorProps,onBelongingChanged:n});document.querySelectorAll(".belonging").forEach((e=>{e.addEventListener("click",o(s))}))}const o=document.querySelector(".notify-subscribers-toggle");if(o){const e=o.querySelector('input[type="checkbox"]');e.addEventListener("click",(()=>{e.parentElement.classList.add("d-none"),o.querySelector(".spinner-container").classList.remove("d-none"),o.submit()}))}}function mt(){const e=document.querySelector(".photo-archive-request-error");e&&document.body.addEventListener("htmx:responseError",(()=>{e.classList.remove("d-none")}))}function ht(e){et(e),mt()}function pt(){const e=document.querySelector(".obituary-composer-form"),t=()=>{if(e){const e=document.querySelector(".edit-memorial-content");e?setTimeout((()=>{e.parentNode.parentNode.scrollIntoView(!0)}),100):document.body.scrollIntoView(!0)}};if(document.body.addEventListener("htmx:beforeRequest",(()=>{t()})),t(),e){const t=e.querySelectorAll('[data-google-autocomplete="location"]'),o=e.querySelectorAll('[data-google-autocomplete="place"]');"object"==typeof window.google&&"object"==typeof window.google.maps&&(t.forEach((e=>{(0,x.A)({element:e,options:{types:["(cities)"]}})})),o.forEach((e=>{(0,x.A)({element:e,options:{types:["establishment","geocode"]}})})));const n=e=>{const t=Array.from(document.querySelectorAll(".school-name-input"));if(e.currentTarget===t.slice(-1)[0]){if(e.currentTarget.value){const o=e.currentTarget.closest(".d-flex"),s=o.cloneNode(!0),i=s.querySelector(".school-name-input");i.value="",i.setAttribute("id",`id_school_name_${t.length}`),i.setAttribute("name",`school_name_${t.length}`),i.addEventListener("change",n),(0,x.A)({element:i,options:{types:["establishment","geocode"]}});const r=s.querySelector(".school-year-input");r.value="",r.setAttribute("id",`id_school_year_${t.length}`),r.setAttribute("name",`school_year_${t.length}`),o.parentNode.appendChild(s)}}else{const t=e.currentTarget.closest(".d-flex"),o=t.parentNode;t.remove(),o.querySelectorAll(":scope > .d-flex").forEach(((e,t)=>{const o=e.querySelector(".school-name-input");o.setAttribute("id",`id_school_name_${t}`),o.setAttribute("name",`school_name_${t}`);const n=e.querySelector(".school-year-input");n.setAttribute("id",`id_school_year_${t}`),n.setAttribute("name",`school_year_${t}`)}))}};document.querySelectorAll(".school-name-input").forEach((e=>{e.addEventListener("change",n)}))}}},9927:function(e,t,o){o.d(t,{A:function(){return a}});var n=o(9635),s=o.n(n),i=o(5189);const r=[void 0,null,""," ","<p></p>","<p><br></p>"];function a(e,t,o,n=null,a=!1,l=null,c=!0,d=!1){if(e&&t){const u=t.closest("form"),m=u.querySelector(".has-warning-modal"),h=e.querySelector("select"),p=e.querySelector('option[value=""]'),g=document.querySelector(".unedited-template-modal-close"),v=document.querySelector(".unedited-template-modal-save"),y=document.querySelector(".modal-unedited-template");let f=!1;(r.includes(t.value)&&(!n||n())||d)&&e.classList.remove("d-none"),t.addEventListener("input",(()=>{if(1===parseInt(t.dataset.selectedTemplate,10))t.dataset.selectedTemplate=0;else if(r.includes(t.value))f=!1,e.classList.remove("d-none"),p.selected=!0;else{const n=o[h.value]||"";let s;if(c){const e=`<p>${n.replace("\n","</p><p>")}</p>`;s=!(t.value.replace(/\s/g,"")===e.replace(/\s/g,""))}else s=!(t.value.replace(/\s/g,"")===n.replace(/\s/g,""));s&&(d||e.classList.add("d-none"),f=!1)}}));let S=h.value;h.addEventListener("change",(()=>{const e=t.value;if(h.value){const e=o[h.value];t.value=c?`<p>${e.replace("\n","</p><p>")}</p>`:e,t.dataset.selectedTemplate=1,f=!0}else t.value="",t.dataset.selectedTemplate=0,f=!1;const n=S;l&&l(t.value,(()=>{t.value=e,h.value=n,(0,i.$I)(t,"input")})),(0,i.$I)(t,"input"),S=h.value})),v&&v.addEventListener("click",(()=>{s().getOrCreateInstance(y).hide(),v.classList.add("disabled"),(0,i.$I)(u,"cancel-submit-protect"),m.dataset.acknowledgedWarning=!0,m.click()})),y&&g&&g.addEventListener("click",(()=>{s().getOrCreateInstance(y).hide(),(0,i.$I)(u,"cancel-submit-protect")})),u.addEventListener("submit",(e=>{if(m){const t=m.dataset.acknowledgedWarning;!a&&y&&f&&!t&&(e.preventDefault(),e.stopImmediatePropagation(),s().getOrCreateInstance(y).show())}}))}}}}]);
//# sourceMappingURL=memorialsPublic~memorialsPrivate.js.652c7fea9325.map